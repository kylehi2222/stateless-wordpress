document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("fstRegistrationForm"),t=document.getElementById("fstResetPasswordForm"),n=window.fluentSupportPublic.reCaptchaSettingsData;function s(e){e.classList.toggle("loading"),e.disabled=!e.disabled}function r(t,n,r){var o=document.getElementById(n);s(o),document.querySelectorAll(".error.text-danger").forEach((function(e){e.parentNode.parentNode.classList.remove("is-error"),e.remove()}));var i=new FormData(t),a=new XMLHttpRequest;document.getElementById("fst_login_form"),a.open("POST",r,!0),a.responseType="json",a.setRequestHeader("X-WP-Nonce",window.fluentSupportPublic.nonce),a.onload=function(){if(this.response.verification_html){var n=this.response.verification_html,r=document.createElement("div");r.innerHTML=n,e.appendChild(r);for(var i=e.getElementsByClassName("fst_registration_fields"),a=0;a<i.length;a++)i[a].style.display="none";var d=e.querySelector("button");d&&(d.style.display="none")}else if(200===this.status)if(this.response.redirect)window.location.href=this.response.redirect;else if(this.response.message){var c=document.createElement("div");c.classList.add("success","text-success"),c.innerHTML=this.response.message,t.appendChild(c)}else window.location.reload();else{var l=this.response.error;if((!l&&this.response.message||l&&403===this.response.data.status||422===this.status)&&(l=this.response.message),l){var u=document.createElement("div");u.classList.add("error","text-danger"),u.innerHTML=l,t.appendChild(u)}else for(var p in this.response){var f=document.getElementById("fst_"+p);if(f){var m=document.createElement("div");m.classList.add("error","text-danger"),m.innerHTML=Object.values(this.response[p])[0],f.parentNode.insertBefore(m,f.nextSibling),f.parentNode.parentNode.classList.add("is-error")}}}s(o)},a.send(i)}function o(e,t,s){e.preventDefault(),t.parentNode.parentNode.classList.toggle("hide"),document.querySelector(s).classList.toggle("hide"),"recaptcha_v3"===n.reCaptcha_version&&function(e){var t="yes"===n.formContainingReCaptcha.signup_form,s="yes"===n.formContainingReCaptcha.login_form;switch(e){case".fst_registration_wrapper":document.querySelector(".grecaptcha-badge").style.visibility=t?"visible":"hidden";break;case".fst_login_wrapper":document.querySelector(".grecaptcha-badge").style.visibility=s?"visible":"hidden";break;default:document.querySelector(".grecaptcha-badge").style.visibility="hidden"}}(s)}function i(e,t){var s=n.reCaptcha_version,r=n.siteKey,o=document.querySelector(e);if("recaptcha_v2"===s)var i='<div class="g-recaptcha" name="g-recaptcha-response" data-sitekey='+r+"></div><br>";else i='<input type="hidden" name="g-recaptcha-response" id='+t+"></input>",grecaptcha.ready((function(){grecaptcha.execute(r,{action:"submit"}).then((function(e){document.getElementById(t).value=e,"yes"===n.formContainingReCaptcha.login_form&&(document.querySelector(".grecaptcha-badge").style.visibility="visible")}))}));return o.insertAdjacentHTML("beforebegin",i),!0}e&&e.addEventListener("submit",(function(t){t.preventDefault(),r(e,"fst_submit",window.fluentSupportPublic.signup)})),t&&t.addEventListener("submit",(function(e){e.preventDefault(),r(t,"fst_reset_pass",window.fluentSupportPublic.resetPass)})),document.getElementById("fs_show_signup")&&document.getElementById("fs_show_signup").addEventListener("click",(function(e){o(e,this,".fst_registration_wrapper")})),document.getElementById("fst_login_form")&&"true"===n.is_enabled&&"yes"===n.formContainingReCaptcha.login_form&&i("#fst_login_form form .login-submit","g-recaptcha-login"),document.getElementById("fs_show_signup")&&"true"===n.is_enabled&&"yes"===n.formContainingReCaptcha.signup_form&&i(".fst_registration_wrapper form #fst_submit","g-recaptcha-signup"),document.getElementById("fs_show_reset_password")&&document.getElementById("fs_show_reset_password").addEventListener("click",(function(e){o(e,this,".fst_reset_pass_wrapper")})),document.getElementById("fs_show_login")&&document.getElementById("fs_show_login").addEventListener("click",(function(e){o(e,this,".fst_login_wrapper")}));var a=document.querySelectorAll("#fst_login_form form");if(a&&a[0]){var d=a[0];d.addEventListener("submit",(function(e){e.preventDefault();var t=document.getElementById("wp-submit");s(t),document.querySelectorAll(".error.text-danger").forEach((function(e){e.parentNode.parentNode.classList.remove("is-error"),e.remove()}));var n=new FormData(a[0]);n.append("_support_login_nonce",window.fluentSupportPublic.fsupport_login_nonce);var o=new XMLHttpRequest;o.open("POST",window.fluentSupportPublic.login,!0),o.responseType="json",n.append("_support_login_nonce",window.fluentSupportPublic.fsupport_login_nonce),o.onload=function(){if(200===this.status)this.response.load_2fa?(document.getElementById("fst_login_form").innerHTML=this.response.two_fa_form,(l=document.getElementById("fst_login_form"))&&l.addEventListener("submit",(function(e){e.preventDefault();var t=document.querySelectorAll("#fst_login_form form"),n=window.fluentSupportPublic.fs_two_fa;r(t[0],"fs_2fa_confirm",n)}))):this.response.redirect?(window.location.href=this.response.redirect,setTimeout((function(){window.location.reload()}),1500)):window.location.href=window.fluentSupportPublic.redirect_fallback;else{var e=this.response.error;if((this.response&&403===this.status||422===this.status)&&(e=this.response.message),e){var n=document.getElementsByClassName("login-submit");n=n.length?n[0]:d;var o=document.createElement("div");o.classList.add("error","text-danger"),o.innerHTML=e,n.parentNode.insertBefore(o,n.nextSibling)}else for(var i in this.response){var a=document.getElementById("fst_"+i);if(a){var c=document.createElement("div");c.classList.add("error","text-danger"),c.innerHTML=Object.values(this.response[i])[0],a.parentNode.insertBefore(c,a.nextSibling),a.parentNode.parentNode.classList.add("is-error")}}}var l;s(t)},o.send(n)}))}}));