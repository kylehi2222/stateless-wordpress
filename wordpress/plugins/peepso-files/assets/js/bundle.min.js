!function s(o,l,d){function n(t,e){if(!l[t]){if(!o[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(a)return a(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=l[t]={exports:{}},o[t][0].call(i.exports,function(e){return n(o[t][1][e]||e)},i,i.exports,s,o,l,d)}return l[t].exports}for(var a="function"==typeof require&&require,e=0;e<d.length;e++)n(d[e]);return n}({1:[function(e,t,i){!function(t){!function(){"use strict";var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},s="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null;const o=("undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null).rest_url+"files";s.observer.addFilter("peepso_activity",e=>(e.on("click.ps-file",".ps-js-file-delete",function(e){e.preventDefault(),e.stopPropagation();let t=(0,i.default)(this).closest(".ps-js-file");e=t.data("id");s.ajax.delete(o,{id:e},-1).done(e=>{e.success&&("delete_activity"===e.action?(e=t.closest(".ps-js-comment-item")).length?e.find(".ps-js-comment-content").text().trim()?t:(e.next('[class*="ps-js-comment-reply"]').remove(),e):t.closest(".ps-js-activity"):t).remove()})}),e),20)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,i){!function(t){!function(){"use strict";var e,s=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},o="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,l="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;class i{constructor(e){this.$btn=(0,s.default)(e),this.$addon=this.$btn.closest(".ps-js-actions").siblings(".ps-js-addons").find(".ps-js-addon-files"),this.$filename=this.$addon.find(".ps-js-filename"),this.$loading=this.$addon.find(".ps-js-loading"),this.$remove=this.$addon.find(".ps-js-remove").on("click",()=>this._removeFile());let t="";l.file.uploadFileTypes instanceof Array&&l.file.uploadFileTypes.length&&(t=`accept=".${l.file.uploadFileTypes.join(",.")}"`),this.$file=(0,s.default)(`<input type="file" name="filedata[]" ${t} />`),this.$file.hide().appendTo(this.$addon),this.file=null,this._uploadInit(),o.observer.addFilter("comment_req",(e,t)=>this.commentAddData(e,t),10,2),(0,s.default)(document).on("ps_comment_aftersave",(e,t,i)=>this.commentAfterSave(i))}upload(){this.$file.trigger("click")}commentAddData(e,t){return(0,s.default)(t).closest(".ps-js-comment-new,.ps-comment-edit").find(".ps-js-addon-files").is(this.$addon)&&this.file&&this.file.name&&(e.file=this.file.name),e}commentAfterSave(e){(0,s.default)(e).closest(".ps-js-comment-new,.ps-comment-edit").find(".ps-js-addon-files").is(this.$addon)&&(o.observer.doAction("file_upload_added",this.file),this._removeFile())}_uploadInit(){this.$file.psFileupload({singleFileUploads:!0,sequentialUploads:!1,replaceFileInput:!0,dropZone:null,pasteZone:null,dataType:"json",url:""+l.rest_url+l.file.uploadUrl,beforeSend:e=>{e.setRequestHeader("X-WP-Nonce",l.rest_nonce)},add:(e,t)=>{this.$file=this.$addon.find("input[type=file]");var i=t.files[0],i=o.observer.applyFilters("file_upload_warning",null,i);if(i)return(0,o.dialog)(i).error(),!1;t._uploadId=(new Date).getTime()+Math.floor(1e3*Math.random()),this._addFile(t),t.submit()},submit:(e,t)=>{var i={user_id:l.currentuserid};t.formData=o.observer.applyFilters("files_upload_req",i,this)},done:(e,t)=>{t=t.result;t.filename&&(this.$loading.hide(),this.$filename.html(t.filename),this.$remove.show(),this.file.name=t.filename)}})}_addFile(e){this.$filename.html("&nbsp;"),this.$loading.show(),this.$remove.hide(),this.$addon.show(),this.file={id:e._uploadId,name:"",size:e.files[0].size},(0,s.default)(document).trigger("ps_comment_addon_added",this.$addon)}_removeFile(){this.$filename.empty(),this.$loading.hide(),this.$remove.hide(),this.$addon.hide(),(this.file=null,s.default)(document).trigger("ps_comment_addon_removed",this.$addon)}}(0,s.default)(document).on("click",".ps-js-comment-files",function(e){e=(0,s.default)(e.currentTarget);let t=e.data("instance");t||(t=new i(e),e.data("instance",t)),t.upload()}),(0,s.default)(document).on("ps_comment_aftersave",function(e,t,i){i=(0,s.default)(i).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-photo");i.find(".ps-js-remove").hide(),i.find(".ps-js-loading").hide(),i.find(".ps-js-img").attr("src","").removeData("id").hide(),i.hide(),(0,s.default)(document).trigger("ps_comment_addon_removed",i)}),o.observer.addFilter("comment_show_button",e=>{var t=(0,s.default)(e.el).closest(".ps-js-comment-new, .ps-js-comment-edit").find(".ps-js-addon-files");return!e.show&&t.is(":visible")&&t.find(".ps-js-filename").is(":visible")&&(e.show=!0),e})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,i){!function(t){!function(){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var e,s=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},o="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,l="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;i.default=class{constructor(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.$el=(0,s.default)(e),this.opts=t,this.$previews=this.$el.find(".ps-js-previews"),this.$fileItems=this.$previews.find(".ps-js-items"),this.$previews.on("click",".ps-js-item .ps-js-remove",e=>this._removePreview(e)),this.$add=this.$previews.find(".ps-js-btn-add"),this.$add.on("click",()=>this.upload());let i="";t.uploadFileTypes instanceof Array&&t.uploadFileTypes.length&&(i=`accept=".${t.uploadFileTypes.join(",.")}"`),this.$file=(0,s.default)(`<input type="file" name="filedata[]" ${i} multiple />`),this.$file.hide().appendTo(e),this.files=[];t=this.$el.find('script[data-name="preview-item"]').text().trim();this.previewTemplate=(0,o.template)(t),this._uploadInit(),this._uploadInitialized=!0}upload(){this._uploadInitialized||(this._uploadInit(),this._uploadInitialized=!0),this.$file.trigger("click")}uploadComplete(){return!0}reset(){this.files=[],this.$el.find(".ps-js-item").remove()}getFiles(){return this.files.filter(e=>!!e.name).map(function(e){return{name:e.name,size:e.size}})}_uploadInit(){this.$file.psFileupload({singleFileUploads:!0,sequentialUploads:!1,replaceFileInput:!0,dropZone:this.$el,pasteZone:null,dataType:"json",url:this.opts.uploadUrl,beforeSend:e=>{0===this.opts.uploadUrl.indexOf(l.rest_url)&&e.setRequestHeader("X-WP-Nonce",l.rest_nonce)},add:(e,t)=>{this.$file=this.$el.find("input[type=file]"),this._uploadSingle(t)},submit:(e,t)=>{var i={user_id:l.currentuserid};t.formData=o.observer.applyFilters("files_upload_req",i,this)},progress:(e,t)=>{this._updatePreview(t)},done:(e,t)=>{t.loaded=t.total,this._updatePreview(t);let i=t._uploadId,s=t.result;s.filename&&0<=(t=this.files.findIndex(e=>e.id===i))&&(this.files[t].name=s.filename,this.emit("uploaded"))}})}_uploadSingle(e){var t=e.files[0],i=o.observer.applyFilters("file_upload_warning",null,this.files.concat([t]));if(i)return this._addPreview(t,e._uploadId,i),this.emit("added"),!1;e._uploadId=(new Date).getTime()+Math.floor(1e3*Math.random()),this._addFile(e),e.submit()}_addFile(e){this.files.push({id:e._uploadId,name:"",size:e.files[0].size}),this._addPreview(e.files[0],e._uploadId),this.emit("added")}_removeFile(t){for(let e=this.files.length-1;0<=e;e--){var i;this.files[e].id===t&&(i=this.files.splice(e,1)[0].name,o.ajax.delete(this.opts.uploadUrl,{filename:i},-1).done(()=>{}).fail(()=>{}))}this.files.length||(this.$fileItems.find(".ps-js-item").remove(),this.emit("empty"))}_addPreview(e,t){e={id:t,name:e.name,error:2<arguments.length&&void 0!==arguments[2]?arguments[2]:null},e=this.previewTemplate(e);(0,s.default)(e).attr("data-preview-id",t).appendTo(this.$fileItems)}_removePreview(e){e.preventDefault(),e.stopPropagation();e=(0,s.default)(e.target).closest(".ps-js-item");this._removeFile(e.data("id")),e.remove()}_updatePreview(e){let t=100*e.loaded/e.total;t=Math.max(0,Math.min(100,t)),t+="%",this.$fileItems.find(`[data-preview-id="${e._uploadId}"]`).find(".ps-js-progress").stop().animate({width:t},2e3,function(){"100%"==t&&(0,s.default)(this).closest(".ps-js-item").addClass("uploaded")})}on(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)}emit(t,i){if(this._events&&this._events[t]instanceof Array)for(let e=0;e<this._events[t].length;e++)(0,this._events[t][e])(i)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(i,e,t){!function(t){!function(){"use strict";var e="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,o="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;i("./postbox"),i("./commentbox"),i("./activitystream"),i("./page-files"),i("./messages"),i("./widget"),e.observer.addFilter("file_upload_warning",function(e,t){t instanceof Array||(t=[t]);for(let e=0;e<t.length;e++){var i=t[e].name.toLowerCase().match(/\.([a-z]+)$/i);if(i&&-1===o.file.uploadFileTypes.indexOf(i[1]))return o.file.texts.fileTypeWarning}var s=t.map(e=>e.size).reduce((e,t)=>e+t);return+o.file.maxUploadSize&&s>1048576*+o.file.maxUploadSize?o.file.texts.maxUploadSizeWarning:+o.file.maxUserSpace&&0<=+o.file.currentUserSpace&&s>+o.file.maxUserSpace-+o.file.currentUserSpace?o.file.texts.maxUserSpaceWarning:+o.file.maxDailyUpload&&0<=+o.file.currentDailyUpload&&t.length>+o.file.maxDailyUpload-+o.file.currentDailyUpload?o.file.texts.maxDailyUploadWarning:+o.file.maxUpload&&0<=+o.file.currentUpload&&t.length>+o.file.maxUpload-+o.file.currentUpload?o.file.texts.maxUploadWarning:e},10,2),e.observer.addAction("file_upload_added",function(e){var t=(e=e instanceof Array?e:[e]).map(e=>e.size).reduce((e,t)=>e+t);0<=+o.file.currentUserSpace&&(o.file.currentUserSpace=+o.file.currentUserSpace+t),0<=+o.file.currentDailyUpload&&(o.file.currentDailyUpload+=e.length),0<=+o.file.currentUpload&&(o.file.currentUpload+=e.length)},10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./activitystream":1,"./commentbox":2,"./messages":5,"./page-files":6,"./postbox":7,"./widget":8}],5:[function(e,t,i){!function(l){!function(){"use strict";var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==l?l.jQuery:null)&&e.__esModule?e:{default:e},s="undefined"!=typeof window?window.peepso:void 0!==l?l.peepso:null;const o=("undefined"!=typeof window?window.peepsodata:void 0!==l?l.peepsodata:null).rest_url+"files";function t(e){e.preventDefault(),e.stopPropagation();let t=(0,i.default)(e.target).closest(".ps-js-file");e=t.data("id");s.ajax.delete(o,{id:e},-1).done(e=>{e.success&&((e=t.closest(".ps-js-message")).find(".ps-js-conversation-content").text().trim()?t:e).remove()})}(0,i.default)(document).on("click.ps-file",".ps-js-chat-window-messages .ps-js-file-delete",t).on("click.ps-file",".ps-js-conversation-wrapper .ps-js-file-delete",t)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,i){!function(d){!function(){"use strict";var i=s("undefined"!=typeof window?window.jQuery:void 0!==d?d.jQuery:null),e=s("undefined"!=typeof window?window._:void 0!==d?d._:null),o="undefined"!=typeof window?window.peepso:void 0!==d?d.peepso:null,t="undefined"!=typeof window?window.peepsodata:void 0!==d?d.peepsodata:null;function s(e){return e&&e.__esModule?e:{default:e}}class l extends PsPageAutoload{constructor(e){super(e),this._search_url=t.rest_url+"files",this._search_params={uid:t.currentuserid,user_id:t.userid,sort:"desc",limit:4,page:1}}onDocumentLoaded(){if(!1===super.onDocumentLoaded())return!1;this._search_$templates=(0,i.default)(".ps-js-files-templates"),this._search_$viewmode=(0,i.default)(".ps-js-files-viewmode");var e=this._search_$templates.filter('[data-name="file-item"]').text().trim();this.itemTemplate=(0,o.template)(e),this._search_$viewmode.on("click",e=>{e.preventDefault(),this.toggleViewMode((0,i.default)(e.currentTarget).data("mode"))}),this.toggleViewMode(o.ls.get("files_viewmode")),this._search_$ct.on("click",".ps-js-item-delete",e=>this.deleteItem(e))}toggleViewMode(e){var t=["list","grid"];e=0<=t.indexOf(e)?e:t[0],this._search_$viewmode.removeClass("ps-btn--active"),this._search_$viewmode.filter(`[data-mode="${e}"]`).addClass("ps-btn--active"),this._search_$ct.removeClass(t.map(e=>"ps-files__list--"+e).join(" ")),this._search_$ct.addClass("ps-files__list--"+e),o.ls.set("files_viewmode",e)}deleteItem(e){e.preventDefault(),e.stopPropagation();let t=(0,i.default)(e.currentTarget).closest(".ps-js-item");e=t.data("id");o.ajax.delete(this._search_url,{id:e},-1).done(e=>{e.success&&t.remove()})}_search_render_html(e){let t="";return e instanceof Array&&(e=e.map(e=>this.itemTemplate(e)),t=e.join("")),t}_search_get_items(){return this._search_$ct.children(".ps-js-item")}_fetch(s){return s=o.observer.applyFilters("files_get_list_files",s),s=i.default.extend({},s),e.default.isUndefined(s.limit)||(s.limit*=2),i.default.Deferred(i=>{o.ajax.get(this._search_url,s,-1).done(e=>{var t;e.files instanceof Array?!e.files.length&&1===s.page&&e.message?(t=[`<div class="ps-alert">${e.message}</div>`],i.rejectWith(this,[t])):i.resolveWith(this,[e.files]):i.rejectWith(this,[e.errors])}).fail(()=>i.rejectWith(this))})}}new l(".ps-js-files")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(n,e,t){!function(d){!function(){"use strict";var t=e("undefined"!=typeof window?window.jQuery:void 0!==d?d.jQuery:null),i="undefined"!=typeof window?window.peepso:void 0!==d?d.peepso:null,s="undefined"!=typeof window?window.peepsodata:void 0!==d?d.peepsodata:null,o=e(n("./dropzone"));function e(e){return e&&e.__esModule?e:{default:e}}class l{constructor(e){this.$postbox=e,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxFile=this.$postbox.find(".ps-postbox-tabs [data-tab-id=file]"),this.$postboxFileUpload=this.$postboxFile.find(".ps-js-file-upload"),this.$postboxFilePreview=this.$postboxFile.find(".ps-js-file-preview"),this.$postboxFileShortcut=this.$postbox.find("#file-post"),this.$postboxTab.on("peepso_posttabs_show-file",()=>this.show()),this.$postboxTab.on("peepso_posttabs_cancel-file",()=>this.cancel()),this.$postboxTab.on("peepso_posttabs_submit-file",()=>this.post()),this.$postboxFileUpload.on("click",()=>this.upload()),this.$postboxFileShortcut.on("click",()=>{this.$postboxTab.find("[data-tab=file]").click()}),this.dropzone=new o.default(this.$postboxFilePreview.find(".ps-js-file-container"),{uploadUrl:""+s.rest_url+s.file.uploadUrl,uploadFileTypes:s.file.uploadFileTypes}),this.dropzone.on("added",()=>{this.showPreview()}),this.dropzone.on("uploaded",()=>{this.$postbox.on_change()}),this.dropzone.on("empty",()=>{this.showButton(),this.$postbox.on_change()}),i.observer.addAction("postbox_type_set",(e,t)=>{e===this.$postbox&&"file"===t&&this.$postboxFileShortcut.trigger("click")},10,2),i.observer.addFilter("peepso_postbox_can_submit",e=>this.canSubmit(e),20,1)}show(){var e=this.$postboxStatusTextarea;e.data("orig-placeholder",e.attr("placeholder")),e.attr("placeholder",s.file.texts.postboxPlaceholder),this.showButton(),this.$postboxFile.show(),this.$postbox.on_change()}showButton(){this.$postboxFilePreview.hide(),this.$postboxFileUpload.show()}showPreview(){this.$postboxFileUpload.hide(),this.$postboxFilePreview.show()}upload(){this.dropzone.upload()}cancel(){var e=this.$postboxStatusTextarea;e.attr("placeholder",e.data("orig-placeholder")),this.dropzone.reset(),this.$postboxFile.hide(),this.$postbox.on_change()}post(){var e="postbox_req_"+this.$postbox.guid;i.observer.addFilter(e,this.postSetRequest,10,1,this),this.$postbox.save_post(),i.observer.removeFilter(e,this.postSetRequest,10),i.observer.doAction("file_upload_added",this.dropzone.getFiles()),this.dropzone.reset()}postSetRequest(e){return t.default.extend(e,{files:this.dropzone.getFiles().map(e=>e.name),type:"files"})}canSubmit(e){return"file"===this.$postboxTab.current_tab_id&&e.hard.push(!!this.dropzone.getFiles().length),e}}i.observer.addAction("peepso_postbox_addons",e=>{return e.push({init(){},set_postbox(e){e.find("#file-post").length&&new l(e)}}),e})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./dropzone":3}],8:[function(e,t,i){!function(t){!function(){"use strict";var e,n=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},a="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,p="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;(0,n.default)(function(){var e=(0,n.default)(".ps-js-widget-my-files, .ps-js-widget-latest-files");e.length&&e.each((e,l)=>{var d=-1<l.className.indexOf("ps-js-widget-my-files")?"files_widget":"community_files_widget";{let e=(0,n.default)(l),t=e.find(".ps-js-widget-content"),i=(0,a.template)(e.find('[data-name="item-template"]').text().trim()),s=+e.data("limit"),o={limit:s,context:d};a.ajax.get(p.rest_url+"files",o).done(e=>{e.files instanceof Array&&e.files.length?(e=e.files.map(e=>i(e)).join(""),t.html(e)):t.empty()})}})})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[4]);