"use strict";jQuery(document).ready(function(){affiliatewp?(affiliatewp.attach("affiliateReview",{$cache:{},localStorageAIAnswerCacheExpiry:30,force:!1,$:function(selector){var _this$$cache$selector;return null!==(_this$$cache$selector=this.$cache[selector])&&void 0!==_this$$cache$selector?_this$$cache$selector:this.$cache[selector]=jQuery(selector)},$ready:function(){this.$('input[name="decision"]').on("change",this.$showRejectTextAreaOnReject),this.$('input[name="decision"]').on("change",this.$switchButtonTexts),this.$('input[name="decision"]').on("change",this.$undecidedAffiliate),this.$('button[name="ask-ai"]').on("click",this.$askAI)},getAffiliateID:function(){return this.$("#affwp_review_affiliate").data("affiliate-id")},$undecidedAffiliate:function(){affiliatewp.affiliateReview.undecidedAffiliate(jQuery(this).val())},undecidedAffiliate:function(decision){var $skip=this.$('input[name="undecided"]',!1),affiliateID=this.getAffiliateID();return"undecided"===decision?void $skip.val($skip.val()+",".concat(affiliateID)):void $skip.val($skip.val().replace(",".concat(affiliateID),""))},$switchButtonTexts:function(){var _jQuery$val;affiliatewp.affiliateReview.syncActionButtonTextsWithDecision(null!==(_jQuery$val=jQuery(this).val())&&void 0!==_jQuery$val?_jQuery$val:"")},syncActionButtonTextsWithDecision:function(decisionValue){var _$exit$data,_$continue$data,$exit=this.$('input[name="exit"][type="submit"]'),$continue=this.$('input[name="continue"][type="submit"]');$exit.attr("value",null!==(_$exit$data=$exit.data("value-".concat(decisionValue)))&&void 0!==_$exit$data?_$exit$data:""),$continue.attr("value",null!==(_$continue$data=$continue.data("value-".concat(decisionValue)))&&void 0!==_$continue$data?_$continue$data:"")},$askAI:function(){var _jQuery$data;affiliatewp.affiliateReview.setAskAIButtonDisabled(!0),affiliatewp.affiliateReview.reviewAffiliate(null!==(_jQuery$data=jQuery(this).data("affiliate-id"))&&void 0!==_jQuery$data?_jQuery$data:0)},hideAskAIButton:function(hide){return hide?void this.$('button[name="ask-ai"]').hide():void this.$('button[name="ask-ai"]').show()},$showRejectTextAreaOnReject:function(){return"reject"===jQuery(this).val()?(affiliatewp.affiliateReview.$("#affwp-rejection-reason").removeClass("hidden"),void affiliatewp.affiliateReview.$('textarea[name="affwp_rejection_reason"]').trigger("focus")):void affiliatewp.affiliateReview.$("#affwp-rejection-reason").addClass("hidden")},reviewAffiliate:function(affiliateID){return this.hasValidLicense?(this.$(".decision-container").addClass("asking-ai"),this.setAllButtonsDisabled(!0),this.setAskingAI(!0),void this.secureDataForProxy(this.hash,affiliateID,function(secureJSON,hash){var cachedAIStatus=this.getCachedAIAnswer(affiliateID,"status"),cachedAIReason=this.getCachedAIAnswer(affiliateID,"reason"),cachedAIRejectionMessage=this.getCachedAIAnswer(affiliateID,"rejection_message");return"rejected"!==cachedAIStatus&&"accepted"!==cachedAIStatus||""===cachedAIReason?void this.makeProxyAIRequest(secureJSON,hash,function(aiStatus,aiReason,aiRejectionMessage,applicationsLeft,fullResponse){this.updateApplicationsLeft(applicationsLeft),this.displayAIAnswer(aiReason,aiStatus),this.cacheAIAnswer(affiliateID,aiStatus,aiReason,aiRejectionMessage),this.setAskAIButtonDisabled(!0),"rejected"===aiStatus&&this.setRejectionMessage(aiRejectionMessage)}):(this.displayAIAnswer(cachedAIReason,cachedAIStatus),""!==cachedAIRejectionMessage&&this.setRejectionMessage(cachedAIRejectionMessage),void this.setAskAIButtonDisabled(!0))})):void this.displayLicenseErrorModal()},updateApplicationsLeft:function(applicationsLeft){this.$("span.ai-reviews-left span.count").html(applicationsLeft.toLocaleString())},logUsage:function(aiResponse){jQuery.ajax({url:this.ajaxURL,method:"POST",dataType:"json",data:{action:"log_affiliate_review_ai_usage",_ajax_nonce:this.nonce,response:aiResponse}})},setRejectionMessage:function(message){var _this=this;"undefined"!=typeof message&&""!==message&&(this.setActionButtonsDisabled(!0),window.setTimeout(function(){return _this.aiStreamContent('textarea[name="affwp_rejection_reason"]',message,function(app){app.setActionButtonsDisabled(!1)})},1e3))},getAICacheKey:function(affiliateID,dataKey){return"AffiliateWPReviewWithAICachedResponse:".concat(dataKey,":").concat(affiliateID)},getCachedAIAnswer:function(affiliateID,dataKey,expiresInSeconds){var _window$localStorage$;if(this.useCaches){"undefined"==typeof expiresInSeconds&&(expiresInSeconds=this.localStorageAIAnswerCacheExpiry);var updated=window.localStorage.getItem(this.getAICacheKey(affiliateID,"updated"));if(!(Date.now()-Number(updated)>1e3*Number(expiresInSeconds)))return null!==(_window$localStorage$=window.localStorage.getItem(this.getAICacheKey(affiliateID,dataKey)))&&void 0!==_window$localStorage$?_window$localStorage$:""}},cacheAIAnswer:function(affiliateID,aiStatus,aiReason,aiRejectionMessage){window.localStorage.setItem(this.getAICacheKey(affiliateID,"reason"),aiReason),window.localStorage.setItem(this.getAICacheKey(affiliateID,"status"),aiStatus),window.localStorage.setItem(this.getAICacheKey(affiliateID,"rejection_message"),aiRejectionMessage),window.localStorage.setItem(this.getAICacheKey(affiliateID,"updated"),Date.now())},displayAIAnswer:function(aiReason,aiStatus){return this.setAllButtonsDisabled(!1),this.setAIError(!1),this.aiStreamContent(".ai-reason",aiReason),this.$('input[name="ai_reason"]').val(aiReason),this.$('input[name="ai_status"]').val(aiStatus),this.setAIAnswered(!0),"accepted"===aiStatus?this.setAIAffiliateAccepted():this.setAIAffiliateRejected()},setAIError:function(hasError,error){return this.setAskingAI(!1),this.setAIAnswered(!1),hasError?this.$('input[name="ask-ai"]').addClass("error").addClass(error):this.$('input[name="ask-ai"]').removeClass("error").removeClass(error)},setAIAnswered:function(answered){return this.setAskingAI(!answered),answered?this.$(".decision-container").addClass("ai-answered"):this.$(".decision-container").removeClass("ai-answered")},setAskingAI:function(asking){return asking?void this.$(".decision-container").addClass("asking-ai").removeClass("ai-answered"):void this.$(".decision-container").removeClass("asking-ai ai-answered")},setAIAffiliateAccepted:function(){this.$('input[type="radio"][value="accept"]').prop("checked",!0).trigger("change").next(".recommendation-label").show(),this.$('input[type="radio"][value="reject"]').prop("checked",!1).removeClass("ai-decision"),this.$(".decision-container").addClass("decision-container-accept")},setAIAffiliateRejected:function(){this.$('input[type="radio"][value="reject"]').prop("checked",!0).trigger("change").next(".recommendation-label").show(),this.$('input[type="radio"][value="accept"]').prop("checked",!1).removeClass("ai-decision"),this.$(".decision-container").addClass("decision-container-reject")},setAllButtonsDisabled:function(disabled){this.setActionButtonsDisabled(disabled),this.setDecisionRadiosDisabled(disabled),this.setAskAIButtonDisabled(disabled)},setActionButtonsDisabled:function(disabled){this.$('input[name="exit"]').prop("disabled",disabled),this.$('input[name="continue"]').prop("disabled",disabled)},setDecisionRadiosDisabled:function(disabled){this.$('input[type="radio"][value="reject"]').prop("disabled",disabled),this.$('input[type="radio"][value="accept"]').prop("disabled",disabled),this.$('input[type="radio"][value="undecided"]').prop("disabled",disabled)},setAskAIButtonDisabled:function(disabled){var $askAIButton=this.$('input[name="ask-ai"]');$askAIButton.prop("disabled",disabled),this.hideAskAIButton(disabled),disabled?$askAIButton.parent().addClass("disabled"):$askAIButton.parent().removeClass("disabled")},aiStreamContent:function(selector,content,func){var _this2=this,$area=this.$(selector),speed=20,time=speed,words=content.split(" ");$area.html("");for(var _loop=function(i){window.setTimeout(function(){return $area.append(words[i]+" ")},time+=Math.floor(Math.random()*(8*speed-speed+speed)))},i=0;i<words.length;i++)_loop(i);var interval=window.setInterval(function(){if($area.val().trim()===content.trim())return"function"!=typeof func?void window.clearInterval(interval):void func(_this2)},500)},secureDataForProxy:function(hash,affiliateID,then){jQuery.ajax({url:this.ajaxURL,method:"GET",dataType:"json",data:{hash:hash,action:"secure_affiliate_review_data",affiliate_id:affiliateID,site:this.siteURL,_ajax_nonce:this.nonce},error:function(data){affiliatewp.affiliateReview.handleError("ai","ajax_failed",affiliatewp.affiliateReview.i18n.ajaxError,data)},success:function(response){var _response$data$secure;if(!response.success){var _response$data$reason,_response$data$messag;affiliatewp.affiliateReview.handleError(null!==(_response$data$reason=response.data.reason)&&void 0!==_response$data$reason?_response$data$reason:"unknown",null!==(_response$data$messag=response.data.message)&&void 0!==_response$data$messag?_response$data$messag:"There was an error securing data for AI.",response)}then.bind(affiliatewp.affiliateReview)(null!==(_response$data$secure=response.data.secureJSON)&&void 0!==_response$data$secure?_response$data$secure:"",hash)}})},handleError:function(feature,error,message,data){if(this.setAIError("ai"===feature,error),this.setAllButtonsDisabled(!1),this.setAskingAI(!1),"invalid_license_key"===error)return this.displayLicenseErrorModal();if("not_enough_credits"===error&&!1===data.customer_purchased_credit_types.monthly_addon)return this.displayMonthlyCreditsPurchaseModal(data.purchase_urls.monthly_addon);if("not_enough_credits"===error&&!0===data.customer_purchased_credit_types.monthly_addon)return this.displayRanOutOfCreditsModal();if("spending_too_many_credits"===error){var _data$max_credits,_data$required_credit;return this.displayMoreCreditModal(null!==(_data$max_credits=data.max_credits)&&void 0!==_data$max_credits?_data$max_credits:0,null!==(_data$required_credit=data.required_credits)&&void 0!==_data$required_credit?_data$required_credit:0)}window.alert(message),console.warn(data)},displayLicenseErrorModal:function(){this.setAllButtonsDisabled(!1);var modal=this.modal(this.i18n.modals.invalidLicense.title,this.i18n.modals.invalidLicense.description,"",{settings:{text:this.i18n.modals.invalidLicense.buttons.settings.title,action:function(){modal.close(),window.open("admin.php?page=affiliate-wp-settings","_blank")},disabled:!1,btnClass:"btn-confirm"},purchase:{text:this.i18n.modals.invalidLicense.buttons.purchase.title,action:function(){modal.close(),window.open("https://affiliatewp.com/ai/reviews/invalid-license/","_blank")},disabled:!1,btnClass:"btn"},help:{text:this.i18n.modals.invalidLicense.buttons.help.title,action:function(){modal.close(),window.open("https://affiliatewp.com/ai/reviews/invalid-license/support/","_blank")},disabled:!1,btnClass:"btn"}},{boxWidth:585})},displayMonthlyCreditsPurchaseModal:function(purchaseURL){this.setAllButtonsDisabled(!1);var modal=this.modal(this.i18n.modals.purchaseMonthly.title,this.i18n.modals.purchaseMonthly.description,"",{purchase:{text:this.i18n.modals.purchaseMonthly.buttons.purchase.title,action:function(){window.open(purchaseURL,"_blank"),modal.close()},disabled:!1,btnClass:"btn-confirm"}})},displayRanOutOfCreditsModal:function(){this.setAllButtonsDisabled(!1);var modal=this.modal(this.i18n.modals.purchaseTopup.title,this.i18n.modals.purchaseTopup.description,"",{purchase:{text:this.i18n.modals.purchaseTopup.buttons.purchase.title,action:function(){window.open("https://affiliatewp.com/ai/reviews/no-credits/","_blank"),modal.close()},disabled:!1,btnClass:"btn-confirm"}})},displayMoreCreditModal:function(maxCredits,requiredCredits){var _this3=this,modal=this.modal(this.i18n.modals.requiredCredits.title,this.i18n.modals.requiredCredits.description.replace("${credits}",requiredCredits),"",{yes:{text:this.i18n.modals.requiredCredits.buttons.yes.title.replace("${credits}",requiredCredits),action:function(){_this3.force=!0,_this3.$('button[name="ask-ai"]').click(),modal.close()},disabled:!1,btnClass:"btn-confirm"},no:{text:this.i18n.modals.requiredCredits.buttons.no.title,action:function(){modal.close()},disabled:!1,btnClass:"btn"}})},modal:function(title,content,icon,buttons,args){return jQuery.alert(jQuery.extend({backgroundDismiss:!0,title:title,icon:icon,type:"lightgreen",content:content,boxWidth:550,useBootstrap:!1,theme:"modern,affiliatewp-education",closeIcon:!0,draggable:!1,dragWindowBorder:!1,buttons:buttons},args))},makeProxyAIRequest:function(secureJSON,hash,then){jQuery.ajax({url:this.proxyUrl+"/wp-json/ai/v1/affiliate-review/",method:"POST",dataType:"json",data:{hash:hash,secure_json:secureJSON,site:this.siteURL,language:this.language,force:this.force?"yes":"no"},error:function(data){affiliatewp.affiliateReview.handleError("ai","ajax_failed",affiliatewp.affiliateReview.i18n.ajaxError,data)},success:function(aiResponse){var _aiResponse$ai_status,_aiResponse$ai_reason,_aiResponse$ai_reject,_aiResponse$available;if(affiliatewp.affiliateReview.logUsage(aiResponse),aiResponse.hasOwnProperty("error")){var _aiResponse$error,_aiResponse$message;return void affiliatewp.affiliateReview.handleError("ai",null!==(_aiResponse$error=aiResponse.error)&&void 0!==_aiResponse$error?_aiResponse$error:"unknown",null!==(_aiResponse$message=aiResponse.message)&&void 0!==_aiResponse$message?_aiResponse$message:"There was an unknown error, please try again.",aiResponse)}if(!aiResponse.hasOwnProperty("ai_reason")||!aiResponse.hasOwnProperty("ai_status")){var _aiResponse$error2,_aiResponse$message2;return void affiliatewp.affiliateReview.handleError("ai",null!==(_aiResponse$error2=aiResponse.error)&&void 0!==_aiResponse$error2?_aiResponse$error2:"unknown",null!==(_aiResponse$message2=aiResponse.message)&&void 0!==_aiResponse$message2?_aiResponse$message2:"There was an unknown error, please try again.",aiResponse)}then.bind(affiliatewp.affiliateReview)(null!==(_aiResponse$ai_status=aiResponse.ai_status)&&void 0!==_aiResponse$ai_status?_aiResponse$ai_status:"",null!==(_aiResponse$ai_reason=aiResponse.ai_reason)&&void 0!==_aiResponse$ai_reason?_aiResponse$ai_reason:"",null!==(_aiResponse$ai_reject=aiResponse.ai_rejection_message)&&void 0!==_aiResponse$ai_reject?_aiResponse$ai_reject:"",null!==(_aiResponse$available=aiResponse.available_applications)&&void 0!==_aiResponse$available?_aiResponse$available:0,aiResponse)}})}},window.affiliateWPAffiliateReview||{},!0),affiliatewp.affiliateReview.$ready()):console.warn("Cannot attach to window.affiliatewp, was it properly enqueued?")});