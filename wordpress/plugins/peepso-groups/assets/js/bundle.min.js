!function s(o,i,a){function n(t,e){if(!i[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=i[t]={exports:{}},o[t][0].call(r.exports,function(e){return n(o[t][1][e]||e)},r,r.exports,s,o,i,a)}return i[t].exports}for(var d="function"==typeof require&&require,e=0;e<a.length;e++)n(a[e]);return n}({1:[function(e,t,s){!function(r){!function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=void 0;var e,i=(e="undefined"!=typeof window?window.jQuery:void 0!==r?r.jQuery:null)&&e.__esModule?e:{default:e},a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=n(t);if(t&&t.has(e))return t.get(e);var r,s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(s,r,i):s[r]=e[r])}s.default=e,t&&t.set(e,s);return s}("undefined"!=typeof window?window.peepso:void 0!==r?r.peepso:null);function n(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(n=function(e){return e?r:t})(e))}const t=peepsogroupsdata.listItemMemberActionsTemplate;s.default=class{constructor(e){this.id=e.id,this.actions=this.constructor.normalize(e),this.template=(0,a.template)(t),this.$el=(0,i.default)("<div />"),this.$el.on("click","[data-method]",e=>{this.onClick(e)}),this.render()}render(){var e=this.template(_.extend({id:this.id},this.actions));this.$el.html(e)}fetch(){return new Promise((t,r)=>{var e={group_id:this.id,keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};a.default.postJson("groupajax.group",e,e=>{e.success?t(e.data):r(e.errors)})})}confirmAction(r){return new Promise((e,t)=>{r?pswindow.confirm(r,()=>{pswindow.hide(),e()},()=>{t()}):e()})}doAction(t,e){return new Promise((r,s)=>{a.default.ajax.post(t,e,-1).done(e=>{if(e.success)if(t.match(/\.(join|leave)$/)){let t=e.data["member_count"];this.fetch().then(e=>{_.extend(e,{member_count:t}),r(e)}).catch(e=>{s(e)})}else r(e.data);else s(e.errors)}).fail(s)})}onClick(s){s.preventDefault(),s.stopPropagation();let o=(0,i.default)(s.currentTarget);if(!o.data("ps-loading")){let r=i.default.extend({},o.data());if(r.method&&r.id){let e=o.find("img"),t=(!e.length&&o.parent().hasClass("ps-js-dropdown-menu")&&(e=(e=o.parent().siblings(".ps-js-dropdown-toggle")).find("img"),o.parent().hide()),r.method);s=r.confirm;r.group_id=r.id,delete r.method,delete r.confirm,delete r.id,this.confirmAction(s).then(()=>{o.data("ps-loading",!0),e.show(),this.doAction(t,r).then(e=>{var t=this.constructor.normalize(e);this.actions=_.defaults({},t,this.actions),this.render(),e.member_count&&a.observer.applyFilters("group_update_member_count",this.id,e.member_count)}).catch(()=>{o.removeData("ps-loading"),e.hide()})}).catch(i.default.noop)}}}static normalize(e){let t,r,s;function o(e,t){return _.map(e,e=>(_.isString(e.action)&&e.action.indexOf(".")<0?e.action=t+"."+e.action:_.isArray(e.action)&&(e.action=o(e.action,t)),e))}return(t=(e=e||{}).group||{}).groupuserajax&&void 0!==t.groupuserajax.member_actions?r=o(t.groupuserajax.member_actions||[],"groupuserajax"):void 0!==e.member_actions&&(r=o(e.member_actions||[],"groupuserajax")),t.groupfollowerajax&&void 0!==t.groupfollowerajax.follower_actions?s=o(t.groupfollowerajax.follower_actions||[],"groupfollowerajax"):void 0!==e.follower_actions&&(s=o(e.follower_actions||[],"groupfollowerajax")),{member_actions:r,follower_actions:s}}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var s,l,c,h=e("./group-actions").default;function o(){c.observer.addFilter("group_update_member_count",function(e,t){var r,e=l(".ps-js-group-item--"+e).find(".ps-js-member-count");e.length&&(r=1<+t?peepsogroupsdata.lang.members:peepsogroupsdata.lang.member,e.html(t+" "+r))},10,2),l(document.body).on("click",".ps-js-groups .ps-js-member-action",l.proxy(function(e){var t,s,r,o=l(e.currentTarget);e.preventDefault(),e.stopPropagation(),o.data("ps-loading")||(s=l.extend({},o.data())).method&&s.id&&(!(t=o.find("img")).length&&o.parent().hasClass("ps-js-dropdown-menu")&&(t=(t=o.parent().siblings(".ps-js-dropdown-toggle")).find("img"),o.parent().hide()),r=s.method,e=s.confirm,s.group_id=s.id,delete s.method,delete s.confirm,delete s.id,this._member_action_confirmation(e).done(function(){o.data("ps-loading",!0),t.show(),this.member_action(r,s).done(function(e){var t=o.closest(".ps-js-member-actions"),r=c.template(peepsogroupsdata.listItemMemberActionsTemplate)(l.extend({id:s.group_id},e));t.html(r),e.member_count&&c.observer.applyFilters("group_update_member_count",s.group_id,e.member_count)})}))},this)),l(document.body).on("click",".ps-js-groups .ps-js-more",l.proxy(function(e){var t=".ps-js-group-item",r="ps-group--expanded",s=l(e.currentTarget).closest(t);e.preventDefault(),e.stopPropagation(),l(".ps-groups").find(t).each(function(){var e=l(this);e.is(s)&&!e.hasClass(r)?(e.addClass(r),e.find(".ps-js-more span").html(peepsogroupsdata.lang.less)):e.hasClass(r)&&(e.removeClass(r),e.find(".ps-js-more span").html(peepsogroupsdata.lang.more))})},this))}e=jQuery,s=peepso,window.ps_groups=(l=e,c=s,o.prototype._fetch=function(u){return l.Deferred(l.proxy(function(p){var e=(u.category||0)+"";this._fetch_xhr=this._fetch_xhr||{},this._fetch_xhr[e]&&this._fetch_xhr[e].abort(),this._fetch_xhr[e]=c.disableAuth().getJson("groupsajax.search",u,l.proxy(function(e){var t,r,s,o,i,a=c.template(peepsogroupsdata.listItemTemplate),n=(c.template(peepsogroupsdata.listItemMemberActionsTemplate),e.data||{}),d="";if(n.groups&&n.groups.length){for(i=0;i<n.groups.length;i++)(t=n.groups[i]).nameHighlight=t.name||"",o=t.description.match("peepso-markdown"),t.description=o?c.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+t.description+"</div>"):l("<div/>").html(t.description||"").text(),u.query&&(r=u.query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r=RegExp("("+r+")","ig"),s='<span style="background:'+c.getLinkColor(.3)+'">$1</span>',t.nameHighlight=t.nameHighlight.replace(r,s),o||(t.description=(t.description||"").replace(r,s))),d+=a(l.extend({},t,{member_actions:""})),_.defer(function(e){var t=l(".ps-js-group-item--"+e.id).find(".ps-js-member-actions"),e=new h({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions});t.html(e.$el)},t);p.resolveWith(this,[d])}else 1<u.page?p.resolveWith(this,[null]):p.rejectWith(this,[e.errors])},this))},this))},o.prototype._member_action_confirmation=function(t){return l.Deferred(l.proxy(function(e){t?pswindow.confirm(t,l.proxy(function(){pswindow.hide(),e.resolveWith(this)},this),l.proxy(function(){e.rejectWith(this)},this)):e.resolveWith(this)},this))},o.prototype.member_action=function(e,r){return l.Deferred(l.proxy(function(t){(e||"").indexOf(".")<0&&(e="groupuserajax."+e),c.postJson(e,r,l.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},new o)},{"./group-actions":1}],3:[function(e,t,r){"use strict";e("./postbox"),e("./groups"),e("./page-groups"),e("./page-groups-categories")},{"./groups":2,"./page-groups":5,"./page-groups-categories":4,"./postbox":6}],4:[function(e,t,r){!function(r){!function(){"use strict";var a,o,s,i="undefined"!=typeof window?window.peepso:void 0!==r?r.peepso:null,e=jQuery;function t(){t.super_.apply(this,arguments)&&a(a.proxy(this.init_page,this))}a=e,e=peepsodata.groups&&peepsodata.groups.categories||{},o=+e.groups_categories_expand_all,s=+e.groups_categories_group_count||4,peepso.npm.inherits(t,PsPageAutoload),peepso.npm.objectAssign(t.prototype,{init_page:function(){var e;this._search_$ct.length&&(this._search_$ct.on("click",".ps-js-groups-cat .ps-js-group-category-title",a.proxy(this._toggle,this)),e=this._search_$ct.data("mode")||"grid",+peepsodata.currentuserid&&(e=i.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),a(".ps-js-groups-viewmode").on("click",e=>{e.preventDefault();e=a(e.currentTarget).data("mode");+peepsodata.currentuserid&&i.ls.set("groups_viewmode_"+peepsodata.currentuserid,e),this.toggleViewMode(e)}))},_search_url:"groupcategoriesajax.search",_search_params:{keys:"id,name,description,url,groups_count",page:1},_search_debounced:_.debounce(function(){this._fetch(this._search_params).done(function(e){e=this._search_render_html(e&&e.group_categories);this._search_toggle_loading("hide"),e?(this._search_$ct.append(e),this._search_toggle_autoscroll("on")):(this._render_uncategorized(),this._search_$nomore.show())}).fail(function(e){this._search_toggle_loading("hide"),this._search_params.page<=1?this._render_uncategorized().done(a.proxy(function(){this._search_$nomore.show()},this)).fail(a.proxy(function(){this._search_$ct.html(e.join("<br>"))},this)):(this._render_uncategorized(),this._search_$nomore.show())})},500),toggleViewMode:function(e){var t=a(".ps-js-groups-viewmode"),r=t.filter(`[data-mode="${e}"]`),s=a(".ps-js-groups"),o="ps-btn--active",i="ps-groups__list--single";r.addClass(o),t.not(r).removeClass(o),"list"===e?s.addClass(i):s.removeClass(i)},_search_render_html:function(e){var t,r=peepso.template(peepsogroupsdata.listCategoriesTemplate),s=null;return e&&e.length&&(s="",_.each(e,function(e){s+=r(_.extend({},e)),t=t||e})),o?setTimeout(a.proxy(function(){this._search_$ct.find(".ps-js-groups-cat").filter(function(){return a(this).find(".ps-js-group-category-action i").hasClass("gci-expand-alt")}).find(".ps-js-group-category-title").trigger("click")},this),1):t&&0<+t.groups_count&&setTimeout(a.proxy(function(){this._unfold_first_row||(this._unfold_first_row=!0,this._search_$ct.find(".ps-js-groups-cat").eq(0).find(".ps-js-group-category-title").trigger("click"))},this),1),setTimeout(()=>{var e=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=i.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e)},1),s},_search_get_items:function(){return this._search_$ct.children(".ps-js-group-category-item")},_fetch:function(e){return a.Deferred(a.proxy(function(t){e=a.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.disableAuth().disableError().getJson(this._search_url,e,a.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},_toggle:function(e){"A"===e.target.tagName&&e.target.href.match(/^https?:\/\//)||(e.preventDefault(),e.stopPropagation(),this._toggle_throttled(e))},_toggle_throttled:_.throttle(function(e){var e=a(e.currentTarget).find(".ps-js-group-category-action i"),t=e.closest(".ps-js-groups-cat"),r="gcis gci-compress-alt";e.hasClass(r)?(e.attr("class","gcis gci-expand-alt"),t.find(".ps-js-groups").hide(),this._collapse(t)):(e.attr("class",r),t.find(".ps-js-groups").show(),this._expand(t))},500),_expand:function(t){var e,r="ps-js-loaded";t.addClass("ps-groups__category--open"),t.hasClass(r)||(e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:t.data("id"),order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:s,page:1},ps_groups._fetch(e).done(function(e){t.addClass(r),t.find(".ps-js-groups").html(e),t.find(".ps-js-group-category-footer").show()}).fail(function(e){t.addClass(r),t.find(".ps-js-groups").html(e.join("<br>")),t.find(".ps-js-group-category-footer").remove()}))},_collapse:function(e){e.removeClass("ps-groups__category--open")},_render_uncategorized:function(){var s=this;return a.Deferred(function(r){var e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:-1,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:1,page:1};ps_groups._fetch(e).done(function(){var e,t;e=peepsogroupsdata.lang.uncategorized,t=peepsogroupsdata.group_url.replace("##category_id##","-1"),(e=s._search_render_html([{id:"-1",name:e,url:t,__uncategorized:!0}]))&&s._search_$ct.append(e),r.resolve()}).fail(function(e){r.reject()})})}}),new t(".ps-js-group-cats")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(s,e,t){!function(r){!function(){"use strict";var p=e("undefined"!=typeof window?window.jQuery:void 0!==r?r.jQuery:null),u=e("undefined"!=typeof window?window._:void 0!==r?r._:null),l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var r,s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(s,r,i):s[r]=e[r])}s.default=e,t&&t.set(e,s);return s}("undefined"!=typeof window?window.peepso:void 0!==r?r.peepso:null),c=e(s("./group-actions"));function a(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(a=function(e){return e?r:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}const h=peepsogroupsdata.listItemTemplate,_=peepsogroupsdata.listItemMemberActionsTemplate;class t extends PsPageAutoload{constructor(e){super(e),this._search_url="groupsajax.search",this._search_params={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:0,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,cover_url,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:2,page:1}}onDocumentLoaded(){if(!1===super.onDocumentLoaded())return!1;this._search_$query=(0,p.default)(".ps-js-groups-query"),this._search_$sortby=(0,p.default)(".ps-js-groups-sortby"),this._search_$sortorder=(0,p.default)(".ps-js-groups-sortby-order"),this._search_$category=(0,p.default)(".ps-js-groups-category"),this._search_$searchmode=(0,p.default)(".ps-js-groups-search-mode"),this._search_params.user_id=+peepsodata.userid||void 0,this._search_params.category=this._search_$category.val()||0,this._search_params.search_mode=this._search_$searchmode.val()||void 0,this._search_$query.on("input",()=>{this._filter()}),this._search_$sortby.on("change",()=>{this._filter()}),this._search_$sortorder.on("change",()=>{this._filter()}),this._search_$category.on("change",e=>{this._filter_category(e)}),this._search_$searchmode.on("change",()=>{this._filter()}),(0,p.default)(".ps-form-search-opt").on("click",()=>{this._toggle()});var e=this._search_$ct.data("mode")||"grid";+peepsodata.currentuserid&&(e=l.ls.get("groups_viewmode_"+peepsodata.currentuserid)||e),this.toggleViewMode(e),(0,p.default)(".ps-js-groups-viewmode").on("click",e=>{e.preventDefault();e=(0,p.default)(e.currentTarget).data("mode");+peepsodata.currentuserid&&l.ls.set("groups_viewmode_"+peepsodata.currentuserid,e),this.toggleViewMode(e)}),this._filter()}toggleViewMode(e){var t=(0,p.default)(".ps-js-groups-viewmode"),r=t.filter(`[data-mode="${e}"]`),s=(0,p.default)(".ps-js-groups"),o="ps-btn--active",i="ps-groups__list--single";r.addClass(o),t.not(r).removeClass(o),"list"===e?s.addClass(i):s.removeClass(i)}_search_render_html(e){let t=(0,l.template)(h),r=((0,l.template)(_),this._search_params.query),s="",o,i,a,n,d;if(e.groups&&e.groups.length)for(d=0;d<e.groups.length;d++)(o=e.groups[d]).nameHighlight=o.name||"",n=o.description.match("peepso-markdown"),o.description=n?l.default.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+o.description+"</div>"):(0,p.default)("<div/>").html(o.description||"").text(),r&&(i=u.default.filter(r.split(" "),function(e){return""!==e}),i=u.default.map(i,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),i=RegExp("("+i.join("|")+")","ig"),a='<span style="background:'+l.default.getLinkColor(.3)+'">$1</span>',o.nameHighlight=o.nameHighlight.replace(i,a),n||(o.description=(o.description||"").replace(i,a))),s+=t(p.default.extend({},o,{member_actions:""})),u.default.defer(function(e){var t=(0,p.default)(".ps-js-group-item--"+e.id).find(".ps-js-member-actions"),e=new c.default({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions});t.html(e.$el)},o);return s}_search_get_items(){return this._search_$ct.children(".ps-js-group-item")}_search_should_load_more(){var e=+peepsodata.activity_limit_below_fold,t=this._search_get_items();return this._search_loadmore_enable&&this._search_loadmore_repeat?!(t.length>=this._search_loadmore_repeat*this._search_params.page):(e=0<e?e:3,this._search_params.limit&&(e*=this._search_params.limit),!!((t=t.slice(0-e).eq(0)).length&&(this._search_loadmore_enable?t.eq(0).offset():t.get(0).getBoundingClientRect()).top<(window.innerHeight||document.documentElement.clientHeight)))}_fetch(s){return p.default.Deferred(t=>{var e=l.default.disableAuth().disableError(),r=this._search_url;s=p.default.extend({},s),this._search_loadmore_enable&&this._search_loadmore_repeat?s.limit=this._search_loadmore_repeat:u.default.isUndefined(s.limit)||(s.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=e.getJson(r,s,e=>{e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])})})}_filter(){this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.query=p.default.trim(this._search_$query.val()),this._search_params.category=this._search_$category.val(),this._search_params.order_by=this._search_$sortby.val(),this._search_params.order=this._search_$sortorder.val(),this._search_params.search_mode=this._search_$searchmode.val(),this._search_params.page=1,this._search()}_filter_category(e){this._filter();let t=window.location.href,r=/(category=)-?\d+/,s=e.target.value||0;t.match(r)&&(t=t.replace(r,"$1"+s),window.history)&&history.pushState&&history.pushState(null,"",t)}_toggle(){(0,p.default)(".ps-js-page-filters").stop().slideToggle()}}new t(".ps-js-groups")}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./group-actions":1}],6:[function(e,t,r){!function(d){!function(){"use strict";var s=e("undefined"!=typeof window?window.jQuery:void 0!==d?d.jQuery:null),o=(e("undefined"!=typeof window?window._:void 0!==d?d._:null),function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=a(t);if(t&&t.has(e))return t.get(e);var r,s={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e){var i;"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((i=o?Object.getOwnPropertyDescriptor(e,r):null)&&(i.get||i.set)?Object.defineProperty(s,r,i):s[r]=e[r])}s.default=e,t&&t.set(e,s);return s}("undefined"!=typeof window?window.peepso:void 0!==d?d.peepso:null)),i="undefined"!=typeof window?window.peepsodata:void 0!==d?d.peepsodata:null;function a(e){var t,r;return"function"!=typeof WeakMap?null:(t=new WeakMap,r=new WeakMap,(a=function(e){return e?r:t})(e))}function e(e){return e&&e.__esModule?e:{default:e}}const r=window.peepsogroupsdata.module_id,n=+window.peepsogroupsdata.force_posts_in_groups;class t extends o.observer.applyFilters("class_postbox_dropdown",10,1){constructor(e){super(e.find("#group-tab")[0]),this.$postbox=e,this.$selected=this.$container.find(".ps-postbox__menu-item-label").hide(),this.$radio=this.$container.find("[type=radio]"),this.$finder=this.$container.find(".ps-js-group-finder"),this.$search=this.$finder.find("input[type=text]"),this.$loading=this.$finder.find(".ps-js-loading"),this.$result=this.$finder.find(".ps-js-result"),this.CATEGORY_ID=void 0,window.peepsoGroupCategory&&(this.CATEGORY_ID=+window.peepsoGroupCategory.id),this.resultTemplate=o.default.template(this.$result.find(".ps-js-result-item-template").text()),this.$dropdown.on("click","[data-option-value]",e=>{var t=(0,s.default)(e.currentTarget).data("optionValue");e.stopPropagation(),this.select(t),"group"!==t&&this.hide()}),this.$postbox.on("postbox.post_cancel postbox.post_saved",()=>this.remove()),o.observer.addFilter("postbox_req",s.default.proxy(this.filterPostboxReq,this),10,1),o.hooks.addFilter("postbox_can_submit","postbox_group",s.default.proxy(this.filterPostboxCanSubmit,this))}show(){super.show(),(n||this.CATEGORY_ID)&&(this.$radio.eq(0).closest("[data-option-value]").hide(),this.$dropdown.find("[data-option-value] .ps-checkbox").hide(),this.select("group"),this.$finder.show())}hide(){super.hide(),this.$radio.get(1).checked&&!this.value()&&(this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide())}value(){let e;return e=this.$radio.get(1).checked&&this.selectedGroup?this.selectedGroup:e}select(e){n||"group"===e?!n&&"group"!==e||(this.$radio.get(1).checked=!0,this.$finder.show(),this.initFinder()):(this.remove(),this.hide())}remove(){var e=!!this.selectedGroup;this.selectedGroup=void 0,this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide(),e&&o.observer.doAction("postbox_group_reset",this.$postbox)}search(t,r){var e,s;return t=(t||"").trim(),r=parseInt(r)||1,e={uid:i.currentuserid,user_id:i.currentuserid,category:this.CATEGORY_ID,query:t,writable_only:1,keys:"id,name,description,avatar_url_full,privacy,groupuserajax.can_pin_posts",order_by:"post_title",order:"ASC",limit:10,page:r},s=e=>{e&&e.data&&(this.query=t,this.page=r,this.render(e.data,r),this.searchEnd=!(e.data&&e.data.groups&&e.data.groups.length))},this.xhr&&this.xhr.abort(),this.xhr=o.default.disableAuth().getJson("groupsajax.search",e,s),this.xhr}render(t,e){var r=this.$result.children(".ps-js-result-list");if(t=t||{},1===(e=e||1)&&r.empty(),t&&t.groups&&t.groups.length)for(let e=0;e<t.groups.length;e++)r.append(this.resultTemplate(t.groups[e]));else 1===e&&r.append(`<li><em>${i.groups.textNoResult}</em></li>`)}initFinder(){this._initialSearch||(this.$search.on("keydown",s.default.proxy(this.onQueryEnter,this)),this.$search.on("input",s.default.proxy(this.onQueryInput,this)),this.$search.on("click",e=>e.stopPropagation()),this.$result.on("click","[data-id]",s.default.proxy(this.onResultSelect,this)),this.$result.on("scroll",s.default.proxy(this.onResultScroll,this)),this.$result.hide(),this.$loading.show(),this.search().always(()=>{this.$loading.hide(),this.$result.show()}),this._initialSearch=!0)}onQueryInput(){let e=this.$search.val(),t=e.replace(/^\s+/,"");e!==t&&this.$search.val(t),this.$result.hide(),this.$loading.show(),clearTimeout(this._onQueryTimer),this._onQueryTimer=setTimeout(s.default.proxy(function(){this.search(t,1).always(s.default.proxy(function(){this.$loading.hide(),this.$result.show()},this))},this),1e3)}onQueryEnter(e){13===e.keyCode&&(e.preventDefault(),e=this.$search.val().replace(/(^\s+|\s+$)/g,""),clearTimeout(this._onQueryTimer),this.$result.hide(),this.$loading.show(),this.search(e,1).always(s.default.proxy(function(){this.$loading.hide(),this.$result.show()},this)))}onResultSelect(e){var e=(0,s.default)(e.currentTarget),t=e.data("id"),r=e.data("name"),e={can_pin_posts:e.data("can-pin-posts")};this.selectedGroup=t,this.$container.addClass("active"),this.$selected.html(r).show(),this.hide(),o.observer.doAction("postbox_group_set",this.$postbox,this.selectedGroup,e)}onResultScroll(e){e.stopPropagation(),!this.searchEnd&&this.$loading.is(":hidden")&&this.$result[0].scrollHeight<=this.$result.scrollTop()+this.$result.innerHeight()&&(this.$loading.show(),this.search(this.query,this.page+1).always(()=>this.$loading.hide()))}filterPostboxReq(e){var t=this.value();return t&&(e.module_id=r,e.group_id=t,e.force_as_group_post=1,e.acc=void 0),e}filterPostboxCanSubmit(e,t){return t!==this.$postbox||!n&&!this.CATEGORY_ID||this.value()||(e=!1,this.show()),e}}o.observer.addAction("peepso_postbox_addons",e=>{return e.push({init(){},set_postbox(e){e.find("#group-tab").length&&new t(e)}}),e},10,1),o.observer.addAction("postbox_init",e=>{e.$el.find("#group-tab").remove()},10,1)}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);