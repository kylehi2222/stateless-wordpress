!function a(r,i,n){function d(t,e){if(!i[t]){if(!r[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(s)return s(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=i[t]={exports:{}},r[t][0].call(o.exports,function(e){return d(r[t][1][e]||e)},o,o.exports,a,r,i,n)}return i[t].exports}for(var s="function"==typeof require&&require,e=0;e<n.length;e++)d(n[e]);return d}({1:[function(e,t,U){!function(H){!function(){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.default=function(){g||(g=(0,o.dialog)(a.group.template_avatar,{wide:!0,destroyOnClose:!1}).show(),v=g.$el,E=v.find(".ps-js-upload").on("click",q),_=function(){var e=(0,s.default)('<input type="file" name="filedata" accept="image/*" data-name="group-avatar-upload" />').css({position:"absolute",opacity:0,height:1,width:1});e.appendTo(document.body),e.psFileupload&&e.psFileupload({formData:{group_id:i,module_id:n,_wpnonce:p},dataType:"json",url:l,replaceFileInput:!1,dropZone:null,add(e,t){var o=t.files[0];o.type.match(/image\/(jpe?g|png|webp)$/i)?o.size>r?M.html(c).show():(M.hide(),T("loading"),t.submit()):M.html(u).show()},done(e,t){var o,a,t=t.result;t.success?(o=t.data&&t.data.image_url,a=t.data&&t.data.orig_image_url,W=!0,T(o,a),m.removeAttr("disabled")):t.errors&&M.html(t.errors[0]).show()}});return e}(),y=v.find(".ps-js-remove").on("click",I),m=v.find(".ps-js-submit").on("click",L),j=v.find(".ps-js-btn-crop").on("click",N),x=v.find(".ps-js-btn-crop-cancel").on("click",X),b=v.find(".ps-js-btn-crop-save").on("click",Y),k=v.find(".ps-js-btn-rotate-l").on("click",{dir:"ccw"},C),D=v.find(".ps-js-btn-rotate-r").on("click",{dir:"cw"},C),M=v.find(".ps-js-error").hide(),Q=v.find(".ps-js-loading").hide(),A=v.find(".ps-js-has-avatar"),O=v.find(".ps-js-no-avatar"),z=v.find(".ps-js-original"),$=v.find(".ps-js-preview"),F=v.find(".ps-js-avatar-loading"),T.apply(null,f?[a.group.img_avatar,a.group.img_avatar_original]:[]),m.attr("disabled","disabled"));return g};var e,t,s=(e="undefined"!=typeof window?window.jQuery:void 0!==H?H.jQuery:null)&&e.__esModule?e:{default:e},o="undefined"!=typeof window?window.peepso:void 0!==H?H.peepso:null,a="undefined"!=typeof window?window.peepsodata:void 0!==H?H.peepsodata:null;const r=+peepsodata.upload_size,i=+a.group.id,n=+a.group.module_id,d=a.group.img_avatar_default,p=a.group.avatar_nonce,l=peepsodata.ajaxurl_legacy+"groupajax.avatar_upload?avatar",u=a.group.text_error_filetype,c=a.group.text_error_filesize;let f=+a.group.has_avatar,h,w,g,v,E,_,y,m,j,x,b,k,D,M,Q,A,O,z,$,F,P,W=!1;function T(e,t){var o;e?("loading"===e?(y.hide(),O.hide(),A.show(),z.hide(),F.show()):(y.show(),O.hide(),A.show(),o="?nocache-"+(new Date).getTime(),f=!0,h=e,$.attr("src",h+o),F.hide(),z.show(),t&&(w=t,z.attr("src",w+o),window.ps_crop.destroy(z))),j.show(),x.hide(),b.hide(),k.show(),D.show()):(y.hide(),A.hide(),O.show(),f=!1,h=d,w=null,$.attr("src",h),z.removeAttr("src"),window.ps_crop.destroy(z))}function q(e){e.preventDefault(),_[0].value=null,_.trigger("click")}function I(e){e.preventDefault();e={group_id:i,module_id:n,_wpnonce:p};o.ajax.post("groupajax.avatar_delete",e).then(e=>{e.success&&(W=!1,T(null),window.ps_crop.destroy(z),g.hide(),m.attr("disabled","disable"),o.hooks.doAction("group_avatar_updated",i,d))})}function L(e){e.preventDefault(),t||(W?(e={group_id:i,module_id:n,_wpnonce:p},t=!0,o.ajax.post("groupajax.avatar_confirm",e).then(e=>{var t;e.success&&(e=e.data&&e.data.image_url,t=e,fetch(t,{cache:"reload",mode:"no-cors"}).then(()=>document.body.querySelectorAll(`img[src='${t}']`).forEach(function(e){e.src=t})),window.ps_crop.destroy(z),g.hide(),W=!1,m.attr("disabled","disabled"),o.hooks.doAction("group_avatar_updated",i,e))}).always(function(){t=!1})):(window.ps_crop.destroy(z),g.hide()))}function N(e){e.preventDefault(),window.ps_crop.init({elem:z,change:e=>{P=function(e,t){let o=(0,s.default)(e),a=1,r=!1,i,n,d;e.naturalWidth&&(i=e.naturalWidth||o.width(),n=e.naturalHeight||o.height(),(800<i||800<n)&&(a=800/Math.max(i,n),i*=a,n*=a,r=!0),a=i/o.width());d={x1:Math.floor(a*t.x),y1:Math.floor(a*t.y),x2:Math.floor(a*(t.x+t.width)),y2:Math.floor(a*(t.y+t.height))},r&&(d.width=i,d.height=n);return d}(z[0],e)}}),j.hide(),x.show(),b.show(),k.hide(),D.hide()}function X(e){e.preventDefault(),window.ps_crop.detach(z),j.show(),x.hide(),b.hide(),k.show(),D.show()}function Y(e){e.preventDefault(),window.ps_crop.detach(z),j.show(),x.hide(),b.hide(),k.show(),D.show();e={x:P.x1,y:P.y1,x2:P.x2,y2:P.y2,width:P.width,height:P.height},W&&(e.tmp=1),e=s.default.extend(e,{u:i,_wpnonce:p});o.ajax.post("groupajax.avatar_crop",e).then(e=>{e.success&&(T(e.data.image_url),W=!0,m.removeAttr("disabled"))})}function C(e){e.preventDefault();e=s.default.extend({direction:"ccw"===e.data.dir?"ccw":"cw"},{u:i,_wpnonce:p},{tmp:W?1:0});T("loading"),o.ajax.post("groupajax.avatar_rotate",e).then(e=>{e.success&&(T(e.data&&e.data.image_url,e.data&&e.data.orig_image_url),W=!0,m.removeAttr("disabled"))})}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(d,e,t){!function(a){!function(){"use strict";var t=o("undefined"!=typeof window?window.jQuery:void 0!==a?a.jQuery:null),r="undefined"!=typeof window?window.peepso:void 0!==a?a.peepso:null,e="undefined"!=typeof window?window.peepsodata:void 0!==a?a.peepsodata:null,i=o(d("./avatar-dialog"));function o(e){return e&&e.__esModule?e:{default:e}}const n=+e.group.id;(0,t.default)(function(){var e=(0,t.default)(".ps-js-focus--group .ps-js-avatar");if(e.length){let o=e.find(".ps-js-avatar-image"),a=e.find(".ps-js-avatar-button-wrapper");r.hooks.addAction("group_avatar_updated","page_group",(e,t)=>{+e==n&&o.attr("src",t),t.match(/\/groups\/\d+\//)?(a.css("cursor",""),a.attr("onclick",`peepso.simple_lightbox('${t.replace("-full.","-orig.")}'); return false`)):(a.css("cursor","default"),a.removeAttr("onclick"))}),e.find(".ps-js-avatar-button").on("click",e=>{e.preventDefault(),e.stopPropagation(),(0,i.default)().show()})}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./avatar-dialog":1}],3:[function(e,t,o){!function(t){!function(){"use strict";var e,h=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},w="undefined"!=typeof window?window._:void 0!==t?t._:null,g="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,v=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};t=n(t);if(t&&t.has(e))return t.get(e);var o,a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(o in e){var i;"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&((i=r?Object.getOwnPropertyDescriptor(e,o):null)&&(i.get||i.set)?Object.defineProperty(a,o,i):a[o]=e[o])}a.default=e,t&&t.set(e,a);return a}("undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null);function n(e){var t,o;return"function"!=typeof WeakMap?null:(t=new WeakMap,o=new WeakMap,(n=function(e){return e?o:t})(e))}const _=window.Hammer,y=+v.default.upload_size,m=+v.group.id,j=+v.group.module_id,x=v.group.img_cover_default,b=v.group.cover_nonce,k=v.default.ajaxurl_legacy+"groupajax.cover_upload?cover",D=v.group.text_error_filetype,M=v.group.text_error_filesize;let A=+v.group.has_cover,O;(0,h.default)(function(){let t=(0,h.default)(".ps-js-focus--group .ps-js-cover");if(!t.length)return;(0,h.default)(".ps-js-cover-upload").on("click",function(e){e.preventDefault(),o[0].value=null,o.trigger("click")});let o=function(){var e=(0,h.default)('<input type="file" name="filedata" accept="image/*" data-name="group-cover-upload" />').css({position:"absolute",opacity:0,height:1,width:1});e.appendTo(document.body),e.psFileupload&&e.psFileupload({formData:{group_id:m,module_id:j,_wpnonce:b},dataType:"json",url:k,replaceFileInput:!1,dropZone:null,add(e,t){var o=t.files[0];o.type.match(/image\/(jpe?g|png|webp)$/i)?o.size>y?alert(M):(p.css("opacity",.5),l.show(),t.submit()):alert(D)},done(e,t){var o,t=t.result;l.hide(),t.success?(o=t.data.image_url,r.show(),n.show(),d.show(),a.show(),A=!0,p.attr("style","").attr("src",o).one("load",u),g.hooks.doAction("group_cover_updated",m,o)):t.errors&&alert(t.errors)}});return e}(),a=(0,h.default)(".ps-js-cover-remove").on("click",function(e){e.preventDefault();let t=(0,g.dialog)(v.group.template_cover_remove).show();t.$el.on("click",".ps-js-cancel",()=>t.hide()),t.$el.on("click",".ps-js-submit",()=>{t.hide(),p.css("opacity",.5);var e={group_id:m,_wpnonce:b};g.ajax.post("groupajax.cover_delete",e).then(e=>{e.success&&(r.hide(),n.hide(),d.hide(),a.hide(),A=!1,p.attr("style","").attr("src",x).one("load",u),g.hooks.doAction("group_cover_updated",m,x))})})}),r=(0,h.default)(".ps-js-cover-reposition").on("click",function(e){e.preventDefault(),p.data("style",p.attr("style")),p.css("z-index",1),t.addClass("ps-focus-cover-edit"),i.show();let a=s.width()-p.width(),r=s.height()-p.height();p.off("mousedown").on("mousedown",function(e){e.preventDefault()}),void 0!==_&&((O=new _.Manager(p[0])).add(new _.Pan({direction:_.DIRECTION_ALL,treshhold:0})),O.on("pan panstart panend",e=>{e.srcEvent.stopPropagation(),e.srcEvent.preventDefault();var t,o=(0,h.default)(e.target);"panstart"===e.type?(o.data("position",o.position()),o.css("cursor","move")):"pan"===e.type?(t=o.data("position"),(e={top:e.deltaY,left:e.deltaX}).left=Math.max(e.left,a-t.left),e.left=Math.min(e.left,0-t.left),e.top=Math.max(e.top,r-t.top),e.top=Math.min(e.top,0-t.top),o.css("transform",`translate3d(${e.left}px, ${e.top}px, 0)`)):(e=100*(t=o.position()).left/s.width(),t=100*t.top/s.height(),e=Math.ceil(1e4*e)/1e4,t=Math.ceil(1e4*t)/1e4,o.css({top:t+"%",left:e+"%",transform:""}),o.removeData("position"),o.data({reposX:e,reposY:t}),o.css("cursor",""))}))}),i=(0,h.default)(".ps-js-cover-reposition-actions").hide(),n=((0,h.default)(".ps-js-cover-reposition-cancel").on("click",function(e){e.preventDefault(),O.destroy(),O=null,t.removeClass("ps-focus-cover-edit"),i.hide(),p.css("z-index",""),p.attr("style",p.data("style")).removeData("style")}),(0,h.default)(".ps-js-cover-reposition-confirm").on("click",function(e){e.preventDefault(),O.destroy(),O=null,t.removeClass("ps-focus-cover-edit"),i.hide(),p.css("z-index","");e={group_id:m,_wpnonce:b,y:p.data("reposX"),x:p.data("reposY")};g.ajax.post("groupajax.cover_reposition",e)}),(0,h.default)(".ps-js-cover-rotate-left").on("click",{dir:"ccw"},e)),d=(0,h.default)(".ps-js-cover-rotate-right").on("click",{dir:"cw"},e),s=t.find(".ps-js-cover-wrapper"),p=t.find(".ps-js-cover-image"),l=t.find(".ps-js-cover-loading");function e(e){e.preventDefault();e=h.default.extend({direction:"ccw"===e.data.dir?"ccw":"cw"},{group_id:m,_wpnonce:b});g.ajax.post("groupajax.cover_rotate",e).then(e=>{e.success&&(e=e.data.image_url,p.attr("style","").attr("src",e).one("load",u),g.hooks.doAction("group_cover_updated",m,e))})}A||(r.hide(),n.hide(),d.hide(),a.hide());let u=()=>{p.css({height:"auto",width:"100%",minWidth:"100%",maxWidth:"100%"});let e=s.height(),t=s.width(),o=p.height(),a=p.width();o<e&&(p.css({height:"100%",width:"auto",minWidth:"100%",maxWidth:"none"}),o=p.height(),a=p.width());var r=parseFloat(p[0].style.top)||0,r=(o>=e&&r<(r=(o-e)/e*-100)&&p.css("top",r+"%"),parseFloat(p[0].style.left)||0);a>=t&&r<(r=(a-t)/t*-100)&&p.css("left",r+"%"),p.css("opacity","")};u=(0,w.throttle)(u,500),p.each(function(){var e=new Image;e.onload=u,e.src=this.src});let c,f=(g.hooks.addAction("browser_resize","group_cover",e=>{c&&c===e.width||(c=e.width,u())}),(0,h.default)(".ps-js-cover-button-popup"));f.on("click",function(e){e.currentTarget===e.target&&(e=(0,h.default)(this).data("cover-url"))&&peepso.simple_lightbox(e)}),g.hooks.addAction("group_cover_updated","page_group",(e,t)=>{+e==m&&(-1<t.indexOf(`/groups/${e}/`)?(f.css("cursor","pointer"),f.data("cover-url",t)):(f.css("cursor",""),f.removeData("cover-url")))})})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,o){"use strict";e("./avatar"),e("./cover")},{"./avatar":2,"./cover":3}],5:[function(e,t,o){"use strict";e("./header")},{"./header":4}]},{},[5]);