!function(e){var o;function s(){s.super_.apply(this,arguments),o(o.proxy(this.init_page,this))}new(o=e,peepso.npm.inherits(s,PsPageAutoload),peepso.npm.objectAssign(s.prototype,{onDocumentLoaded:function(){this._search_$ct=o(this._css_prefix).eq(0),this._search_$trigger=o(this._css_prefix+"-triggerscroll"),this._search_$loading=o(this._css_prefix+"-loading"),this._search_$nomore=o(peepsodata.activity.template_no_more).hide().insertBefore(this._search_$trigger)},init_page:function(){this._search_$query=o(".ps-js-members-query").on("input",o.proxy(this._filter,this)),this._search_$gender=o(".ps-js-members-gender").on("change",o.proxy(this._filter,this)),this._search_$sortby=o(".ps-js-members-sortby").on("change",o.proxy(this._filter,this)),this._search_$avatar=o(".ps-js-members-avatar").on("click",o.proxy(this._filter,this)),this._search_$following=o(".ps-js-members-following").on("change",o.proxy(this._filter,this));var e=decodeURIComponent(window.location.href).match(/members\/(pending|invited|management|banned)/),s={invited:"pending_user",pending:"pending_admin",management:"management",banned:"banned"};this._search_params.role=e?s[e[1]]:"",this._search_$extended=o(".ps-js-filter-extended").find("input[type=radio], select"),this._search_$extended.prop("oninput",""),this._search_$extended.filter("select").addClass("ps-select").on("change",o.proxy(this._filter,this)),this._search_$extended.filter("input[type=radio]").on("click",o.proxy(function(e){e=o(e.target);e.data("ps-checked")?(e.removeData("ps-checked"),e[0].checked=!1):e.data("ps-checked",1),this._filter()},this)),o(".ps-form-search-opt").on("click",o.proxy(this._toggle,this)),this._filter(),peepso.observer.addAction("pending_admin_member_count",function(e,s){e===+peepsogroupsdata.group_id&&((e=o(".ps-js-pending-count[data-id="+e+"]")).html(s),s||e.closest(".ps-js-pending-label").remove())},10,2),peepso.observer.addAction("pending_user_member_count",function(e,s){e===+peepsogroupsdata.group_id&&($label=o(".ps-js-invited-count[data-id="+e+"]"),$label.html(s))},10,2)},_search_url:"groupusersajax.search",_search_params:{group_id:peepsogroupsdata.group_id,keys:"id,avatar,cover,fullname,profileurl,role",limit:2,page:1},_search_render_html:function(e){var s,t=peepso.template(peepsogroupsdata.memberItemTemplate),i="";if(e.members&&e.members.length)for(s=0;s<e.members.length;s++)i+=t(o.extend({},e.members[s]));return this._get_passive_actions(),i},_search_get_items:function(){return this._search_$ct.children(".ps-js-member")},_fetch:function(e){return o.Deferred(o.proxy(function(s){e=o.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.disableAuth().disableError().getJson(this._search_url,e,o.proxy(function(e){e.success?s.resolveWith(this,[e.data]):s.rejectWith(this,[e.errors])},this))},this))},_filter:function(){var e=o.trim(this._search_$query.val()),s=this._search_$sortby.val().split("|"),t=this._search_$gender.val(),i=this._search_$avatar[0].checked?1:0,r=this._search_$following[0].value,a={};this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.query=e||void 0,this._search_params.order_by=s[0]||void 0,this._search_params.order=s[1]||void 0,this._search_params.peepso_gender=t||void 0,this._search_params.peepso_avatar=i||void 0,this._search_params.peepso_following=r||void 0,this._search_params.page=1,this._search_$extended.each(function(){var e=o(this);"SELECT"===e[0].tagName?a[this.name]=this.value:"radio"===e.attr("type")&&(void 0===a[this.name]&&(a[this.name]=void 0),e[0].checked&&(a[this.name]=this.value))}),_.extend(this._search_params,a),this._search()},_get_passive_actions:_.debounce(function(){var r="ps-js-actions-placeholder",e=this._search_$ct.find("."+r),a=peepso.template(peepsogroupsdata.memberItemActionsTemplate);e.each(o.proxy(function(e,s){var t=o(s).removeClass(r),i=+t.data("id");t.show(),this._fetch_passive_actions(i).done(function(e){e=o.extend(e,{id:this._search_params.group_id,passive_user_id:i}),t.html(a(e))}).fail(function(){t.remove()})},this))},100),_fetch_passive_actions:function(e){var t={group_id:this._search_params.group_id,passive_user_id:e};return o.Deferred(o.proxy(function(s){peepso.getJson("groupuserajax.member_passive_actions",t,o.proxy(function(e){e=e.data||{};e.member_passive_actions&&e.member_passive_actions.length?s.resolveWith(this,[e]):s.rejectWith(this)},this))},this))},_toggle:function(){o(".ps-js-page-filters").stop().slideToggle()}}),s)(".ps-js-group-members")}(jQuery);