!function(e,o){ps_group=new(function(m,j){const d=window.peepsogroupsdata&&+window.peepsogroupsdata.max_categories;function e(){this.ajax={};this.cover={};this.cover.x_position_percent=0;this.cover.y_position_percent=0;this.$cover_ct=jQuery(".js-focus-cover");this.$cover_image=peepsogroupsdata.group_id?jQuery("img#"+peepsogroupsdata.group_id):jQuery();this.initial_cover_position=this.$cover_image.attr("style");j.observer.addFilter("postbox_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("show_more_posts",function(e){if(+peepsogroupsdata.group_id){e.stream_id=peepsogroupsdata.module_id;e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}else if(+peepsogroupsdata.group_category_id)e.group_category_id=peepsogroupsdata.group_category_id;return e},10,1);j.observer.addFilter("photos_validate_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_upload_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_rotate_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_get_list_photos",function(e){var o=peepsodata.profile&&+peepsodata.profile.id;if(!o&&+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_get_list_albums",function(e){var o=peepsodata.profile&&+peepsodata.profile.id;if(!o&&+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_create_album_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_add_photos_to_album_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_remove_temp_files",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_delete_album",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("photos_delete_stream_album",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("peepso_list_videos",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("tags_get_taggable_params",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("show_avatar_dialog",function(e){if(peepsogroupsdata.id)return m.proxy(this.showAvatarDialog,this);else return e},10,1,this);j.observer.addAction("group_name_updated",function(e,o){var i;if(+peepsogroupsdata.group_id===+e){i=m(".ps-js-group-header");if(i.length)i.find(".ps-focus-title > span").text(o)}},10,2,this);j.observer.addAction("group_privacy_updated",function(e,o){if(+peepsogroupsdata.group_id===+e)if(m(".ps-page--group-settings").length)window.location.reload()},10,2,this);j.observer.addFilter("files_upload_req",function(e){if(+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1);j.observer.addFilter("files_get_list_files",function(e){var o=peepsodata.profile&&+peepsodata.profile.id;if(!o&&+peepsogroupsdata.group_id){e.module_id=peepsogroupsdata.module_id;e.group_id=peepsogroupsdata.group_id}return e},10,1)}return e.prototype.init_page=function(t){if(t){this._header_$el=m(".ps-js-group-header");this._header_$actions=m(".ps-js-group-header-actions");this._header_$actions_loadingHtml=this._header_$actions.eq(0).html();this._header_$actions.html(this._header_$actions_loadingHtml);this._get_data(t).done(function(e){this._data=e;j.observer.applyFilters("group_data",e)});j.observer.addFilter("group_data",m.proxy(function(e){this._update_header_actions(e)},this),10,1);this._header_$actions.on("click",".ps-js-join",m.proxy(function(e){var o=m(e.currentTarget).find("img").show();this.join(t).done(function(e){o.hide();window.location.reload()})},this));this._header_$actions.on("click",".ps-js-leave",m.proxy(function(e){var o=m(e.currentTarget).find("img").show();this.leave(t).done(function(e){o.hide();window.location.reload()})},this));this.init()}m(document.body).on("click",".ps-js-group-member-action",m.proxy(function(e){var n=m(e.currentTarget);if(n.data("ps-loading"))return;e.preventDefault();e.stopPropagation();var p=m.extend({},n.data());if(!p.method||!(p.id||t))return;var o=n.find("img");if(!o.length&&n.parent().hasClass("ps-js-dropdown-menu")){o=n.parent().siblings(".ps-js-dropdown-toggle");o=o.find("img");n.parent().hide()}var d=p.method;var i=p.confirm;p.group_id=p.id||t;delete p.method;delete p.confirm;delete p.id;this._member_action_confirmation(i).done(function(){if(d.indexOf("search_to_invite")>=0){this.invite(t);return}n.data("ps-loading",true);o.show();this.member_action(d,p).done(function(e){var o=n.closest(".ps-js-member"),i,t;if(d.indexOf("passive")>=0){if(e.reload){window.location.reload();return}if(e.hide){o.remove();if(!_.isUndefined(e.pending_user_member_count))j.observer.doAction("pending_user_member_count",+p.group_id,+e.pending_user_member_count);if(!_.isUndefined(e.pending_admin_member_count))j.observer.doAction("pending_admin_member_count",+p.group_id,+e.pending_admin_member_count)}else{if(!_.isUndefined(e.display_role)){var s=e.display_role,r=o.find('script[data-role="'+s+'"]'),a=o.find(".ps-js-member-role");if(r.length)a.html(r.text()).show();else a.hide().html("")}if(e.member_passive_actions&&e.member_passive_actions.length){i=j.template(peepsogroupsdata.memberItemActionsTemplate);t={member_passive_actions:e.member_passive_actions,id:p.group_id,passive_user_id:p.passive_user_id};o.find(".ps-js-dropdown").html(i(t))}}if(+peepsodata.currentuserid===+p.passive_user_id){this._header_$actions.html(this._header_$actions_loadingHtml);this._get_data(p.group_id).done(function(e){this._data=e;j.observer.applyFilters("group_data",e)})}j.observer.doAction("notification_clear_cache")}else if(d.match(/\.?join$/))window.location.reload();else if(d.indexOf("leave")>=0)if(e.member_actions&&e.member_actions.length>1)this._update_header_actions(e);else window.location.reload();else this._update_header_actions(e)}).fail(function(e){n.removeData("ps-loading");o.hide();if(e&&e.length)pswindow.show("",e.join("<br/>"))})})},this));m(document.body).on("click",".ps-js-groups .ps-js-more",m.proxy(function(e){e.preventDefault();e.stopPropagation();var o=m(e.currentTarget).closest(".ps-js-group-item"),i=o.find(".ps-js-owner"),t=o.find(".ps-js-categories"),s=o.find(".ps-js-category-icon");if(+peepsogroupsdata.list_show_owner)if(!i.data("ps-loaded")&&!i.data("ps-loading")){i.data("ps-loading",true);this.get_owners(i.data("id")).done(function(e){i.data("ps-loaded",true);i.removeData("ps-loading");if(e&&e.length)i.html('<a href="'+e[0].profileurl+'">'+e[0].fullname+"</a>");else i.html("<em>No owner</em>")})}if(!t.data("ps-loaded")&&!t.data("ps-loading")){t.data("ps-loading",true);this.get_categories(t.data("id")).done(function(e){t.data("ps-loaded",true);t.removeData("ps-loading");if(e&&e.length){e=_.map(e,function(e){return'<a href="'+e.url+'">'+e.name+"</a>"});t.html(e.join(", "));if(e.length>1)s.attr("class","ps-icon-tags")}else t.html("<em>No category</em>")})}},this));m(".ps-js-focus .ps-js-privacy .ps-js-dropdown-menu").on("click","[data-option-value]",function(e){var o=m(e.currentTarget),i=o.closest(".ps-js-dropdown-menu"),r=i.siblings(".ps-js-dropdown-toggle"),t=+o.data("optionValue"),a;if(t===+peepsogroupsdata.privacy)return;a={privacy:t,group_id:peepsogroupsdata.group_id,_wpnonce:peepsogroupsdata.nonce_set_group_privacy};pswindow.confirm(peepsogroupsdata.lang.privacy_change_confirmation,function(){var s=r.find("img").show();pswindow.hide();j.getJson("groupajax.set_group_privacy",a,function(e){var o=r.find("i"),i=o.siblings("span"),t;s.hide();if(e.success){t=e.data.new_privacy;peepsogroupsdata.privacy=t.id;o.attr("class",t.icon);i.html(t.name);r.addClass("ps-list-info-success");setTimeout(function(){r.removeClass("ps-list-info-success")},1e3);j.observer.doAction("group_privacy_updated",a.group_id,{id:t.id,icon:t.icon,name:t.name})}else if(e.errors)psmessage.show("",e.errors[0])})})});m(".ps-js-focus-box-toggle").on("click",function(e){var o=m(".ps-js-focus-desc"),i=m(document),t="click.ps-focusbox-toggle",s="ps-focus__desc--open";e.stopPropagation();if(o.hasClass(s)){o.removeClass(s);i.off(t)}else{o.addClass(s);i.one(t,function(){o.removeClass(s)})}})},e.prototype._get_data=function(i){return m.Deferred(m.proxy(function(o){var e={group_id:i,context:"cover",keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};j.ajax.get("groupajax.group",e,5).done(function(e){if(e.success)o.resolveWith(this,[e.data]);else o.rejectWith(this,[e.errors])}.bind(this))},this))},e.prototype._normalize_header_actions=function(e,t){return _.map(e,function(e){var o=e.label||"",i=o.charAt(0);if(i.match(/[a-z]/))o=i.toUpperCase()+o.slice(1);e.label=o;if(_.isString(e.action)&&e.action.indexOf(".")<0)e.action=t+"."+e.action;else if(_.isArray(e.action))e.action=this._normalize_header_actions(e.action,t);return e},this)},e.prototype._update_header_actions=function(e){var o=j.template(peepsogroupsdata.headerActionsTemplate),i,t,s;e=e||{};s=e.group||{};if(s.groupuserajax&&!_.isUndefined(s.groupuserajax.member_actions))i=s.groupuserajax.member_actions||[];else if(!_.isUndefined(e.member_actions))i=e.member_actions||[];if(i)i=this._normalize_header_actions(i,"groupuserajax");if(s.groupfollowerajax&&!_.isUndefined(s.groupfollowerajax.follower_actions))t=s.groupfollowerajax.follower_actions||[];else if(!_.isUndefined(e.follower_actions))t=e.follower_actions||[];if(t)t=this._normalize_header_actions(t,"groupfollowerajax");this._header_actions=this._header_actions||{};this._header_actions.member_actions=i||this._header_actions.member_actions;this._header_actions.follower_actions=t||this._header_actions.follower_actions;this._header_$actions.html(o(this._header_actions));_.defer(m.proxy(function(){var e=window.location,o=e.href,i,t;if(o.match(/#membership/)){i=this._header_$actions.find(".ps-js-btn-membership");t=i.siblings(".ps-js-dropdown-menu").show();i.add(t).addClass("ps-list-info-success");setTimeout(function(){i.add(t).removeClass("ps-list-info-success")},1e3);if("replaceState"in window.history)history.replaceState("",document.title,e.pathname+e.search)}},this))},e.prototype.get_owners=function(i){return m.Deferred(m.proxy(function(o){var e={group_id:i,role:"owner",keys:"fullname,profileurl"};j.getJson("groupusersajax.search",e,m.proxy(function(e){if(e.data&&e.data.members)o.resolveWith(this,[e.data.members]);else o.rejectWith(this,[e.errors])},this))},this))},e.prototype.get_members=function(i){return m.Deferred(m.proxy(function(o){var e={group_id:i,keys:"avatar,fullname,profileurl,role"};j.getJson("groupusersajax.search",e,m.proxy(function(e){if(e.data&&e.data.members)o.resolveWith(this,[e.data.members]);else o.rejectWith(this,[e.errors])},this))},this))},e.prototype.get_categories=function(i){return m.Deferred(m.proxy(function(o){var e={group_id:i,keys:"name,url"};j.getJson("groupcategoriesgroupsajax.categories_for_group",e,m.proxy(function(e){if(e.data&&e.data.categories)o.resolveWith(this,[e.data.categories]);else o.rejectWith(this,[e.errors])},this))},this))},e.prototype.join=function(e){return m.Deferred(m.proxy(function(o){j.postJson("groupuserajax.join",{group_id:e},m.proxy(function(e){if(e.success)o.resolveWith(this,[e.data]);else o.rejectWith(this,[e.errors])},this))},this))},e.prototype.leave=function(e){return m.Deferred(m.proxy(function(o){j.postJson("groupuserajax.leave",{group_id:e},m.proxy(function(e){if(e.success)o.resolveWith(this,[e.data]);else o.rejectWith(this,[e.errors])},this))},this))},e.prototype.invite=function(e){j.groups.dlgInvite(e)},e.prototype.inviteUser=function(e,i){return m.Deferred(m.proxy(function(o){j.getJson("groupuserajax.passive_invite",{group_id:e,passive_user_id:i},m.proxy(function(e){if(e.success)o.resolveWith(this,[e.data]);else o.rejectWith(this,[e.errors])},this))},this))},e.prototype.edit_name=function(i,e){var o=m(e).closest(".ps-js-group-name"),t=o.find(".ps-js-group-name-text"),s=o.find(".ps-js-group-name-editor"),r=o.find(".ps-js-btn-edit"),a=o.find(".ps-js-btn-cancel"),n=o.find(".ps-js-btn-submit"),p=s.find("input[type=text]"),d=o.find(".ps-js-limit"),u=p.val();if(s.is(":visible"))return;t.hide();r.hide();a.show();n.show();s.show();p.focus();_.defer(function(){p[0].selectionStart=p[0].selectionEnd=u.length});if(!p.data("original-value")){p.data("original-value",u);p.off("input keydown").on("input",function(e){var o=m.trim(p.val()),i=m.trim(p.data("original-value")),t=+p.data("maxlength");if(t&&o.length>t){o=o.substr(0,t);p.val(o)}d.html(t-o.length);if(!o||o===i)n.attr("disabled","disabled");else n.removeAttr("disabled")}).on("keydown",function(e){if(e.keyCode===13){e.preventDefault();e.stopPropagation();if(!n.attr("disabled"))n.click()}})}p.trigger("input");a.off("click").on("click",function(){p.val(p.data("original-value"));s.hide();n.hide();a.hide();r.show();t.show()});n.off("click").on("click",m.proxy(function(){var e=peepsogroupsdata.lang.name_change_confirmation;pswindow.confirm(e,m.proxy(function(){var e=n.find("img").show(),o=p.val();pswindow.hide();this._updateName(i,o).always(function(){e.hide()}).done(function(){p.data("original-value",o);t.text(o);a.click()}).fail(function(e){psmessage.show("",e)})},this),function(){pswindow.hide();a.click()})},this))},e.prototype._updateName=function(i,t){var s="_xhr_"+i,e=this._updateName[s];if(e)e.abort();return m.Deferred(m.proxy(function(o){var e=j.postJson("groupajax.set_group_name",{group_id:i,name:t,_wpnonce:peepsogroupsdata.nonce_set_group_name},m.proxy(function(e){if(e.success){j.observer.doAction("group_name_updated",i,t);o.resolve()}else if(e.errors)o.reject(e.errors[0]);else o.reject()},this));this._updateName[s]=e.ret},this))},e.prototype.edit_slug=function(o,e){var i=m(e).closest(".ps-js-group-slug"),t=i.find(".ps-js-group-slug-text"),s=i.find(".ps-js-group-slug-editor"),r=i.find(".ps-js-group-slug-trigger"),a=i.find(".ps-js-cancel"),n=i.find(".ps-js-submit"),p,d,u;if(s.is(":visible"))return;t.hide();r.hide();a.show();n.show();s.show();d=s.find(".ps-js-submit");p=s.find("input");p.data("original-value",u=p.val());p.focus().val("").val(u);s.off("click input");a.off("click").on("click",function(){p.val(u);s.hide();n.hide();a.hide();r.show();t.show()});n.off("click").on("click",m.proxy(function(e){this.save_slug(o,p.val(),e.currentTarget)},this));s.on("input","input",function(e){var o=m(e.currentTarget),i=o.closest(".ps-js-group-slug").find(".ps-js-limit"),t=+o.data("maxlength"),s=o.val();if(t&&s.length>t){s=s.substr(0,t);o.val(s)}i.html(t-s.length);if(m.trim(s))d.removeAttr("disabled");else d.attr("disabled","disabled")});p.trigger("input")},e.prototype.save_slug=function(e,o,i){var t="save_slug",s;if(this.ajax[t])return;this.ajax[t]=true;o=m.trim(o);s=m(i).find(".ps-js-loading");s.show();j.postJson("groupajax.set_group_slug",{group_id:e,slug:o,_wpnonce:peepsogroupsdata.nonce_set_group_slug},m.proxy(function(e){this.ajax[t]=false;s.hide();if(e.success)window.location=e.data.redirect;else if(e.errors)j.dialog(e.errors[0],{error:true}).show()},this))},e.prototype.save_name=function(e,a,n){var p="save_name",d;if(this.ajax[p])return;this.ajax[p]=true;a=m.trim(a);d=m(n).find(".ps-js-loading");d.show();j.postJson("groupajax.set_group_name",{group_id:e,name:a,_wpnonce:peepsogroupsdata.nonce_set_group_name},m.proxy(function(e){var o=m(n).closest(".ps-js-group-name"),i=o.find(".ps-js-group-name-text"),t=o.find(".ps-js-group-name-editor"),s=o.find(".ps-js-group-name-trigger"),r=t.find("input");this.ajax[p]=false;d.hide();if(e.success){r.val(a);t.off("click").hide();i.text(a).show();s.show();if(e.data&&e.data.redirect)window.location=e.data.redirect}else if(e.errors)psmessage.show("",e.errors[0])},this))},e.prototype.edit_cats=function(i,e){var o=m(e).closest(".ps-js-group-cat"),t=o.find(".ps-js-group-cat-text"),s=o.find(".ps-js-group-cat-editor"),r=o.find(".ps-js-btn-edit"),a=o.find(".ps-js-cancel"),n=o.find(".ps-js-submit"),p;if(s.is(":visible"))return;t.hide();r.hide();a.show();n.show();s.show();p=s.find("input[type=checkbox], input[type=radio]");p.each(function(){m(this).data("original-value",this.checked)});s.off("click");a.off("click").on("click",function(){p.each(function(){this.checked=m(this).data("original-value")});s.hide();n.hide();a.hide();r.show();t.show()});n.off("click").on("click",m.proxy(function(e){var o=p.filter(function(){return this.checked}).map(function(){return+this.value});o=Array.prototype.slice.call(o);this.save_cats(i,o,e.currentTarget)},this));p.on("click",function(e){var o=s.find(".ps-js-submit"),i=p.filter(":checked"),t=p.not(i);if("checkbox"===e.target.type)if(i.length>=d){t.prop("disabled",true);t.parent().css("opacity",.3)}else{t.prop("disabled",false);t.parent().css("opacity","")}if(i.length>=1)o.removeAttr("disabled");else o.attr("disabled","disabled")});p.first().triggerHandler("click")},e.prototype.save_cats=function(e,d,u){var c="save_cats",l;if(this.ajax[c])return;this.ajax[c]=true;l=m(u).find(".ps-js-loading");l.show();j.postJson("groupajax.set_group_categories",{group_id:e,category_id:d,_wpnonce:peepsogroupsdata.nonce_set_group_categories},m.proxy(function(e){var o=m(u).closest(".ps-js-group-cat"),i=o.find(".ps-js-group-cat-text"),t=o.find(".ps-js-group-cat-editor"),s=o.find(".ps-js-btn-edit"),r=o.find(".ps-js-cancel"),a=o.find(".ps-js-submit"),n=t.find("input[type=checkbox], input[type=radio]"),p=[];this.ajax[c]=false;l.hide();if(e.success){n.each(function(){this.checked=d.indexOf(+this.value)>=0;if(this.checked)p.push(['<a href="',peepsogroupsdata.group_url.replace("##category_id##",this.value),'">',m(this).next("label").text(),"</a>"].join(""))});t.off("click").hide();i.html(p.join("")).show();a.hide();r.hide();s.show()}else if(e.errors)psmessage.show("",e.errors[0])},this))},e.prototype.edit_desc=function(o,e){var i=m(e).closest(".ps-js-group-desc"),t=i.find(".ps-js-group-desc-text"),s=i.find(".ps-js-group-desc-placeholder"),r=i.find(".ps-js-group-desc-editor"),a=i.find(".ps-js-btn-edit"),n=i.find(".ps-js-cancel"),p=i.find(".ps-js-submit"),d,u;if(r.is(":visible"))return;t.hide();s.hide();a.hide();n.show();p.show();r.show();$submit=r.find(".ps-js-submit");d=r.find("textarea");d.data("original-value",u=d.val());d.focus().val("").val(u);r.off("click input");n.off("click").on("click",function(){d.val(u);r.hide();p.hide();n.hide();a.show();if(m.trim(u)){t.show();s.hide()}else{t.hide();s.show()}});p.off("click").on("click",m.proxy(function(e){this.save_desc(o,d.val(),e.currentTarget)},this));r.on("input","textarea",function(e){var o=m(e.currentTarget),i=o.closest(".ps-js-group-desc").find(".ps-js-limit"),t=+o.data("maxlength"),s=o.val();if(t&&s.length>t){s=s.substr(0,t);o.val(s)}i.html(t-s.length);if(m.trim(s))$submit.removeAttr("disabled");else $submit.attr("disabled","disabled")});d.trigger("input")},e.prototype.save_desc=function(e,f,g){var h="save_desc",v;if(this.ajax[h])return;this.ajax[h]=true;f=m.trim(f||"");v=m(g).find(".ps-js-loading");v.show();j.postJson("groupajax.set_group_description",{group_id:e,description:f,_wpnonce:peepsogroupsdata.nonce_set_group_description},m.proxy(function(e){var o=m(g).closest(".ps-js-group-desc"),i=o.find(".ps-js-group-desc-text"),t=o.find(".ps-js-group-desc-placeholder"),s=o.find(".ps-js-group-desc-editor"),r=o.find(".ps-js-btn-edit"),a=o.find(".ps-js-cancel"),n=o.find(".ps-js-submit"),p=s.find("textarea"),d=m(".ps-js-focus-desc");this.ajax[h]=false;v.hide();if(e.success){p.val(f);s.off("click").hide();n.hide();a.hide();r.show();f=_.escape(m.trim(f));f=f.replace(/(?:\r\n|\r|\n)/g,"<br />");var u=i.find(".peepso-markdown"),c=f,l=f;if(u.length)l=j.observer.applyFilters("peepso_parse_content",'<div class="peepso-markdown">'+l+"</div>");if(c){i.html(l).show();t.hide();d.html(l)}else{i.text(l).hide();t.show();d.text(l)}}else if(e.errors)psmessage.show("",e.errors[0])},this))},e.prototype._member_action_confirmation=function(o){return m.Deferred(m.proxy(function(e){if(o)pswindow.confirm(o,m.proxy(function(){pswindow.hide();e.resolveWith(this)},this),m.proxy(function(){e.rejectWith(this)},this));else e.resolveWith(this)},this))},e.prototype.member_action=function(e,i){return m.Deferred(function(o){if(!e){o.rejectWith(this);return}if(-1===e.indexOf("."))e="groupuserajax."+e;j.ajax.post(e,i,-1).done(function(e){if(e.data)o.resolveWith(this,[e.data]);else o.rejectWith(this,[e.errors])}.bind(this)).fail(function(){o.rejectWith(this)}.bind(this))}.bind(this))},e.prototype.init=function(){jQuery(".js-focus-cover").hover(function(){if(false===pswindow.is_visible)jQuery(".js-focus-change-cover").show()},function(){jQuery(".js-focus-change-cover").hide()});jQuery(".ps-tab__bar").unbind("click");var e=this;this.$cover_image.one("load",function(){e.fix_horizontal_padding()}).each(function(){if(this.complete)jQuery(this).trigger("load")});jQuery(window).on("resize.focus-image",jQuery.proxy(this.fix_horizontal_padding_debounced,this))},e.prototype.fix_horizontal_padding=function(){var e,o,i;this.$cover_image.css({height:"auto",width:"100%",minWidth:"100%",maxWidth:"100%"});o=this.$cover_ct.width()*.375;o=Math.max(o,this.$cover_ct.height());i=this.$cover_image.height();if(i<o)this.$cover_image.css({height:o,width:"auto",minWidth:"100%",maxWidth:"none"});this.initial_cover_position=this.$cover_image.attr("style")},e.prototype.fix_horizontal_padding_debounced=_.debounce(function(){this.fix_horizontal_padding()},300),e.prototype.show_avatar_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-avatar");var o=e.find("#dialog-upload-avatar-title").html();var i=e.find("#dialog-upload-avatar-content").html();var t=e.find(".dialog-action").html();var s=pswindow.show(o,i).set_actions(t);var r=s.$container.find(".ps-dialog");r.addClass("ps-dialog-wide");j.observer.addFilter("pswindow_close",function(){r.removeClass("ps-dialog-wide")},10,1);this.init_avatar_fileupload();jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-avatar .fileupload:visible").psFileupload("destroy")})},e.prototype.init_avatar_fileupload=function(){var a=this;jQuery(".upload-avatar .fileupload:visible").psFileupload({formData:{group_id:peepsogroupsdata.group_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"groupajax.avatar_upload?avatar",add:function(e,o){var i=/(\.|\/)(jpe?g|png|webp)$/i;if(o.files[0]["type"].length&&!i.test(o.files[0]["type"])){var t=jQuery("#profile-avatar-error-filetype").text();jQuery(".ps-js-error").html(t)}else if(parseInt(o.files[0]["size"])>peepsodata.upload_size){var s=jQuery("#profile-avatar-error-filesize").text();jQuery(".ps-js-error").html(s)}else{jQuery("#ps-window .ps-loading-image").show();jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").hide();jQuery(".ps-js-error").hide();pswindow.refresh();o.submit()}},done:function(e,o){var i=o.result;if(i.success){var t=jQuery("#dialog-upload-avatar-content",jQuery(i.data.html));var s=jQuery("#dialog-upload-avatar .dialog-action").html();var r="?"+Math.random();jQuery(".js-focus-avatar img",t).attr("src",i.data.image_url+r);jQuery(".imagePreview img",t).attr("src",i.data.orig_image_url+r);jQuery(".imagePreview",t).after('<input type="hidden" name="is_tmp" value="1"/>');jQuery(".ps-js-has-avatar",t).show();jQuery(".ps-js-no-avatar",t).hide();pswindow.set_content(t);pswindow.set_actions(s);jQuery("#imagePreview img").one("load",function(){pswindow.refresh()});a.init_avatar_fileupload();jQuery("#ps-window button[name=rep_submit]").removeAttr("disabled").addClass("ps-btn-primary");a.invalid_avatar_upload=false;a.avatar_use_gravatar=false}else{jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").show();jQuery(".ps-js-error").html(i.errors).show();jQuery("#ps-window .ps-loading-image").hide();jQuery("#ps-window button[name=rep_submit]").attr("disabled","disabled").removeClass("ps-btn-primary");a.invalid_avatar_upload=true}}})},e.prototype.confirm_avatar=function(o){var i,e;if(this.invalid_avatar_upload)return;i=this.confirm_avatar;if(i._loading)return;i._loading=true;if(o){o=jQuery(o);o.attr("disabled","disabled")}e={group_id:peepsogroupsdata.group_id,module_id:peepsogroupsdata.module_id,_wpnonce:jQuery("#_covernonce").val()};j.postJson("groupajax.avatar_confirm",e,function(e){if(e&&e.success){window.location.reload();return}i._loading=false;if(o)o.removeAttr("disabled")})},e.prototype.confirm_remove_avatar=function(){var e=jQuery("#delete-confirmation #delete-title").html();var o=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,o)},e.prototype.remove_avatar=function(e){var o={group_id:peepsogroupsdata.group_id,user_id:e,_wpnonce:jQuery("#_covernonce").val()};j.postJson("groupajax.avatar_delete",o,function(e){if(e.success)window.location.reload()})},e.prototype.confirm_remove_cover_photo=function(){var e=jQuery("#delete-confirmation #delete-title").html();var o=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,o)},e.prototype.remove_cover_photo=function(e){var o={group_id:peepsogroupsdata.group_id,_wpnonce:jQuery("#_covernonce").val()};j.postJson("groupajax.cover_delete",o,function(e){if(e.success)window.location.reload()})},e.prototype.reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").hide();jQuery(".js-focus-change-cover > a",".js-focus-cover").hide();jQuery(".reposition-cover-actions",".js-focus-cover").show();jQuery(".js-focus-cover").addClass("ps-focus-cover-edit");var r=this;var i=jQuery(".js-focus-cover").height()-jQuery("img#"+peepsogroupsdata.group_id).height();var t=jQuery(".js-focus-cover").width()-jQuery("img#"+peepsogroupsdata.group_id).width();jQuery("img#"+peepsogroupsdata.group_id).draggable({cursor:"move",drag:function(e,o){o.position.top<i&&(o.position.top=i),o.position.top>0&&(o.position.top=0),o.position.left<t&&(o.position.left=t),o.position.left>0&&(o.position.left=0)},stop:function(e,o){var i=jQuery("img#"+peepsogroupsdata.group_id),t=i.closest(".js-focus-cover"),s=100*o.position.top/t.height();s=Math.round(1e4*s)/1e4;y=100*o.position.left/t.width();y=Math.round(1e4*y)/1e4;r.cover.x_position_percent=s;r.cover.y_position_percent=y;i.css("top",s+"%");i.css("left",y+"%")}})},e.prototype.cancel_reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").show();jQuery(".js-focus-change-cover > a",".js-focus-cover").show();jQuery(".reposition-cover-actions",".js-focus-cover").hide();jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit");jQuery("img#"+peepsogroupsdata.group_id).attr("style",this.initial_cover_position);jQuery("img#"+peepsogroupsdata.group_id).draggable("destroy")},e.prototype.save_reposition_cover=function(){var e={group_id:peepsogroupsdata.group_id,x:this.cover.x_position_percent,y:this.cover.y_position_percent,_wpnonce:jQuery("#_covernonce").val()};var o=this;jQuery(".reposition-cover-actions",".js-focus-cover").hide();jQuery(".ps-reposition-loading",".js-focus-cover").show();jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit");j.postJson("groupajax.cover_reposition",e,function(e){jQuery(".ps-reposition-loading",".js-focus-cover").hide();o.initial_cover_position=jQuery("img#"+peepsogroupsdata.group_id).attr("style");o.cancel_reposition_cover()})},e.prototype.show_cover_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-cover");var o=e.find("#dialog-upload-cover-title").html();var i=e.find("#dialog-upload-cover-content").html();pswindow.show(o,i);this.init_cover_fileupload();jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-cover .fileupload:visible").psFileupload("destroy")})},e.prototype.init_cover_fileupload=function(){var t=this;jQuery(".upload-cover .fileupload:visible").psFileupload({formData:{group_id:peepsogroupsdata.group_id,module_id:peepsogroupsdata.module_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"groupajax.cover_upload?cover",add:function(e,o){var i=/(\.|\/)(jpe?g|png|webp)$/i;if(o.files[0]["type"].length&&!i.test(o.files[0]["type"])){var t=jQuery("#profile-cover-error-filetype").text();jQuery(".ps-js-error").html(t)}else if(parseInt(o.files[0]["size"])>peepsodata.upload_size){var s=jQuery("#profile-cover-error-filesize").text();jQuery(".ps-js-error").html(s)}else{jQuery("#ps-window .ps-loading-image").show();jQuery("#ps-window .upload-cover").hide();o.submit()}},done:function(e,o){var i=o.result;jQuery("#ps-window .ps-loading-image").hide();jQuery("#ps-window .upload-cover").show();if(i.success){jQuery(".cover-image").attr("src",i.data.image_url+"?"+Math.random()).css("top","0").css("left","0").removeClass("default").addClass("has-cover");pswindow.fade_out("slow");jQuery("#profile-reposition-cover").show();jQuery("#dialog-upload-cover-content").html(i.data.html);pswindow.set_content(jQuery("#dialog-upload-cover-content",i.data.html).html());t.fix_horizontal_padding_debounced();t.init_cover_fileupload()}else jQuery(".ps-js-error").html(i.errors)}})},e.prototype.showAvatarDialog=function(){var e;if(peepsogroupsdata.id){if(!this.avatarDialog){e={id:+peepsogroupsdata.id,name:peepsogroupsdata.name,hasAvatar:+peepsogroupsdata.hasAvatar,imgAvatar:peepsogroupsdata.imgAvatar,imgOriginal:peepsogroupsdata.imgOriginal};if(!e.hasAvatar)e.imgOriginal="";this.avatarDialog=new PsGroupAvatarDialog(e)}this.avatarDialog.show()}},e.prototype.edit_property=function(e,t,s){var o=m(e).closest(".ps-js-group-"+s),r=o.find(".ps-js-text"),i=o.find(".ps-js-editor"),a=o.find(".ps-js-btn-edit"),n=o.find(".ps-js-btn-cancel"),p=o.find(".ps-js-btn-submit"),d=i.find('select[name="'+s+'"]'),u=d.val();if(i.is(":visible"))return;r.hide();a.hide();n.show();p.show();i.show();if(d.data("psInitialized"))return;d.data("psInitialized",1);d.data("initialValue",u);d.off("change").on("change",function(){var e=m(this),o=e.val(),i=e.data("initialValue");if(!o||o===i)p.attr("disabled","disabled");else p.removeAttr("disabled")});n.off("click").on("click",function(){d.val(d.data("initialValue"));i.hide();p.hide();n.hide();a.show();r.show()});p.off("click").on("click",function(){var o=p.find("img"),i=d.val();if(o.is(":visible"))return;o.show();j.postJson("groupajax.set_group_property",{group_id:t,property_name:s,property_value:i,_wpnonce:peepsogroupsdata.nonce_set_group_property},function(e){o.hide();if(e.success){d.data("initialValue",i);r.html(d.children("option:selected").text())}n.click()})})},e.prototype.edit_custom_input=function(e,t,s){var o=m(e).closest(`.ps-js-group-${s}`),r=o.find(".ps-js-text"),i=o.find(".ps-js-editor"),a=o.find(".ps-js-btn-edit"),n=o.find(".ps-js-btn-cancel"),p=o.find(".ps-js-btn-submit"),d=i.find(`[name="${s}"]`),u=d.val();if(i.is(":visible"))return;r.hide();a.hide();n.show();p.show();i.show();if(d.data("psInitialized"))return;d.data("psInitialized",1);d.data("initialValue",u);d.off("change").on("change",function(){var e=m(this),o=e.val(),i=e.data("initialValue");if(!o||o===i)p.attr("disabled","disabled");else p.removeAttr("disabled")});n.off("click").on("click",function(){d.val(d.data("initialValue"));i.hide();p.hide();n.hide();a.show();r.show()});p.off("click").on("click",function(){var o=p.find("img"),i=d.val();if(o.is(":visible"))return;o.show();j.postJson("groupajax.set_group_custom_input",{group_id:t,custom_name:s,custom_value:i,_wpnonce:peepsogroupsdata.nonce_set_group_custom_input},function(e){o.hide();if(e.success){d.data("initialValue",i);r.html(d.children("option:selected").text())}n.click()})})},e}(e,o)),e(function(){ps_group.init_page(+peepsogroupsdata.group_id)})}(jQuery,peepso);